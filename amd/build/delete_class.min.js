define("local_grupomakro_core/delete_class", ["core/ajax", "jquery"], (function (Ajax, $) {
    "use strict";

    var selectedClassIds = [];

    return {
        init: function () {
            window.console.log("Class management JS initialized");
            handleViewToggle();
            handleSelectAll();
            handleCheckboxChange();
            handleDeleteClass();
            handleConfirmDeleteClass();
        }
    };

    function handleViewToggle() {
        var gridBtn = $('#btn-grid-view'),
            listBtn = $('#btn-list-view'),
            gridView = $('#class-grid-view'),
            listView = $('#class-list-view');

        var savedView = localStorage.getItem("classManagementView") || "grid";

        function setView(viewType) {
            window.console.log("Setting view to: " + viewType);
            if (viewType === 'grid') {
                gridBtn.addClass('active');
                listBtn.removeClass('active');
                gridView.removeClass('d-none');
                listView.addClass('d-none');
                localStorage.setItem('classManagementView', 'grid');
            } else {
                listBtn.addClass('active');
                gridBtn.removeClass('active');
                listView.removeClass('d-none');
                gridView.addClass('d-none');
                localStorage.setItem('classManagementView', 'list');
            }
        }

        setView(savedView);
        gridBtn.on('click', function (e) { e.preventDefault(); setView('grid'); });
        listBtn.on('click', function (e) { e.preventDefault(); setView('list'); });
    }

    function handleSelectAll() {
        $('#selectAllClasses').on('change', function (event) {
            var isChecked = $(event.target).is(':checked');
            $('.class-checkbox').prop('checked', isChecked);
            updateBulkDeleteButton();
        });
    }

    function handleCheckboxChange() {
        $(document).on('change', '.class-checkbox', function () {
            updateBulkDeleteButton();
            if ($('.class-checkbox').length === $('.class-checkbox:checked').length) {
                $('#selectAllClasses').prop('checked', true);
            } else {
                $('#selectAllClasses').prop('checked', false);
            }
        });
    }

    function updateBulkDeleteButton() {
        selectedClassIds = [];
        $('.class-checkbox:checked').each(function (index, element) {
            selectedClassIds.push($(element).val());
        });

        if (selectedClassIds.length > 0) {
            $('#bulkDeleteButton').removeClass('d-none');
        } else {
            $('#bulkDeleteButton').addClass('d-none');
        }
    }

    function handleDeleteClass() {
        $(document).on('click', '.deleteButton', function (event) {
            var singleClassId = $(this).attr('class-id');
            selectedClassIds = [singleClassId];
        });
    }

    function handleConfirmDeleteClass() {
        $('#confirmDeleteButton').on('click', function () {
            if (selectedClassIds.length === 0) return;

            var requests = selectedClassIds.map(function (id) {
                return {
                    methodname: 'local_grupomakro_delete_class',
                    args: { id: id }
                };
            });

            Ajax.call(requests)[0].done(function () {
                window.location.reload();
            }).fail(function (error) {
                window.console.error(error);
            });
        });
    }
}));