define("local_grupomakro_core/create_class",["exports","core/ajax","jquery"],(function(_exports,Ajax,_jquery){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}let selectedInstance;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Ajax);const typeSelector=(0,(_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj}).default)("#classtype"),classroomSelector=(0,_jquery.default)("#classroom"),classNameInput=(0,_jquery.default)("#classname"),careerSelector=(0,_jquery.default)("#career"),periodSelector=(0,_jquery.default)("#period"),courseSelector=(0,_jquery.default)("#courses"),teacherSelector=(0,_jquery.default)("#instructor"),initTimeInput=(0,_jquery.default)("#starttime"),endTimeInput=(0,_jquery.default)("#endtime"),saveButton=(0,_jquery.default)("#saveClassButton"),mondaySwitch=(0,_jquery.default)("#customSwitchMonday"),tuesdaySwitch=(0,_jquery.default)("#customSwitchTuesday"),wednesdaySwitch=(0,_jquery.default)("#customSwitchWednesday"),thursdaySwitch=(0,_jquery.default)("#customSwitchThursday"),fridaySwitch=(0,_jquery.default)("#customSwitchFriday"),saturdaySwitch=(0,_jquery.default)("#customSwitchSaturday"),sundaySwitch=(0,_jquery.default)("#customSwitchSunday"),errorModal=(0,_jquery.default)("#errorModal"),errorModalContent=(0,_jquery.default)("#error-modal-content"),selectors=[typeSelector,careerSelector,periodSelector,courseSelector,teacherSelector,classNameInput,initTimeInput,endTimeInput,classroomSelector],switches=[mondaySwitch,tuesdaySwitch,wednesdaySwitch,thursdaySwitch,fridaySwitch,saturdaySwitch,sundaySwitch];let periods,courses,teachers,classRooms;const instanceIDs={isi_panama:0,grupomakro_col:1,grupomakro_mex:2};_exports.init=classrooms=>{classRooms=JSON.parse(classrooms),handleInstanceSelection(),handleCareerSelection(),handlePeriodSelection(),handleCourseSelection(),handleClassSave(),handleTypeSelector()};const handleTypeSelector=()=>{typeSelector.change((()=>{let classroomSelectorContainer=(0,_jquery.default)("#classroom-fieldset");"0"===typeSelector.val()||"2"===typeSelector.val()?(classroomSelector.prop("required",!0),classroomSelectorContainer.removeClass("d-none")):"1"===typeSelector.val()&&(classroomSelector.removeAttr("required"),classroomSelectorContainer.addClass("d-none"))}))},handleClassSave=()=>{saveButton.click((()=>{endTimeInput.get(0).setCustomValidity(""),mondaySwitch.get(0).setCustomValidity("");if(!selectors.every((selector=>selector.get(0).reportValidity())))return;if(initTimeInput.val()>=endTimeInput.val())return endTimeInput.get(0).setCustomValidity("La hora de finalización debe ser mayor a la hora de inicio."),void endTimeInput.get(0).reportValidity();if(!switches.some((day=>day.is(":checked"))))return mondaySwitch.get(0).setCustomValidity("Se debe seleccionar al menos un día de clase."),void mondaySwitch.get(0).reportValidity();const args={name:classNameInput.val(),type:typeSelector.val(),instance:instanceIDs[selectedInstance],learningPlanId:careerSelector.val(),periodId:periodSelector.val(),courseId:courseSelector.val(),instructorId:teacherSelector.val(),initTime:initTimeInput.val(),endTime:endTimeInput.val(),classDays:formatSelectedClassDays(),classroomId:classroomSelector.val(),classroomCapacity:classroomSelector.val()?classRooms.find((classroom=>classroom.value==classroomSelector.val())).capacity:40};Ajax.call([{methodname:"local_grupomakro_create_class",args:args}])[0].done((function(response){if(-1!==response.status)window.location.href="/local/grupomakro_core/pages/classmanagement.php";else try{const errorMessages=JSON.parse(response.message);let errorHTMLString="";errorMessages.forEach((message=>{errorHTMLString+=`<p class="text-center">${message}</p>`})),errorModalContent.html(errorHTMLString)}catch(error){errorModalContent.html(`<p class="text-center">${response.message}</p>`)}finally{errorModal.modal("show")}})).fail((function(error){window.console.error(error)}))}))},handleInstanceSelection=()=>{(0,_jquery.default)("a.company-instance").click((function(){(0,_jquery.default)(".form-check .card").removeClass("active"),(0,_jquery.default)(this).parent(".form-check").find("input").click(),(0,_jquery.default)(this).find(".card").addClass("active"),selectedInstance=(0,_jquery.default)("input:radio:checked").val(),(0,_jquery.default)("#fields-groups").removeClass("d-none")}))},handleCareerSelection=()=>{careerSelector.change((()=>{if(""===careerSelector.val())return;const args={learningPlanId:careerSelector.val()};Ajax.call([{methodname:"local_sc_learningplans_get_learning_plan_periods",args:args}])[0].done((function(response){(0,_jquery.default)(".periodValue").remove(),(0,_jquery.default)(".courseValue").remove(),(0,_jquery.default)(".teacherValue").remove(),periods=JSON.parse(response.periods),periods.length?periods.forEach((_ref=>{let{id:id,name:name}=_ref;periodSelector.append(`<option class="periodValue" value="${id}">${name}</option>`)})):periodSelector.val("").change()})).fail((function(response){window.console.error(response)}))}))},handlePeriodSelection=()=>{periodSelector.change((()=>{if(""===periodSelector.val())return;const args={learningPlanId:careerSelector.val(),periodId:periodSelector.val()};Ajax.call([{methodname:"local_sc_learningplans_get_learning_plan_courses",args:args}])[0].done((function(response){(0,_jquery.default)(".courseValue").remove(),(0,_jquery.default)(".teacherValue").remove(),courses=JSON.parse(response.courses),courses.length?courses.forEach((_ref2=>{let{id:id,name:name}=_ref2;courseSelector.append(`<option class="courseValue" value="${id}">${name}</option>`)})):courseSelector.val("").change()})).fail((function(response){window.console.error(response)}))}))},handleCourseSelection=()=>{courseSelector.change((()=>{if(""===courseSelector.val())return;const args={learningPlanId:careerSelector.val()};Ajax.call([{methodname:"local_sc_learningplans_get_learning_plan_teachers",args:args}])[0].done((function(response){(0,_jquery.default)(".teacherValue").remove(),teachers=JSON.parse(response.teachers),teachers.length?(teacherSelector.prop("disabled",!1),teachers.forEach((_ref3=>{let{userid:userid,fullname:fullname,email:email}=_ref3;teacherSelector.append(`<option class="teacherValue" value="${userid}">${fullname} (${email})</option>`)}))):teacherSelector.val("").change()})).fail((function(response){window.console.error(response)}))}))},formatSelectedClassDays=()=>{let daysString="";return switches.forEach((day=>{daysString+=(day.is(":checked")?1:0)+"/"})),daysString.substring(0,daysString.length-1)}}));

//# sourceMappingURL=create_class.min.js.map