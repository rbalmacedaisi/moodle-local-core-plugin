function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("local_grupomakro_core/institutional_contracts",["exports","core/ajax","jquery"],(function(_exports,Ajax,_jquery){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Ajax);var selectedInstitutionId,selectedContractId,selectedUser,selectedInstitutionContractUsers,availableUsers,selectedUserToBeCreated,institutionContracts,selectedContractUserId,createContractButton=(0,(_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj}).default)("#create-contract-button"),removeContractButtons=(0,_jquery.default)(".remove-contract"),removeContractConfirmButton=(0,_jquery.default)("#remove-contract-confirm-button"),confirmContractDeletionModal=(0,_jquery.default)("#confirmModalCenter"),viewUserDetailsButtons=(0,_jquery.default)(".view-details-button"),userInfoName=(0,_jquery.default)("#user-info-name"),userInfoEmail=(0,_jquery.default)("#user-info-email"),userInfoAvatar=(0,_jquery.default)("#user-info-avatar"),viewUserProfileButton=(0,_jquery.default)("#view-profile-button"),userInfoContractList=(0,_jquery.default)("#user-info-contract-list"),confirmContractUserDeletionModal=(0,_jquery.default)("#confirmContractUserDeletionModal"),confirmContractUserDeletionButton=(0,_jquery.default)("#remove-contract-_user_confirm-button"),selectedUserInput=(0,_jquery.default)("#selected-user"),contractSelectInput=(0,_jquery.default)("#contractlist"),coursesSelectInput=(0,_jquery.default)("#courselist"),newContractUserInputs=[selectedUserInput,contractSelectInput,coursesSelectInput],addUserButton=(0,_jquery.default)("#add-user-button"),errorModal=(0,_jquery.default)("#errorModal"),errorModalContent=(0,_jquery.default)("#error-modal-content");_exports.init=function(institutionId,institutionContractUsers,users,contractNames){selectedInstitutionContractUsers=institutionContractUsers,selectedInstitutionId=institutionId,availableUsers=users,institutionContracts=contractNames,handleCreateContractButtonClick(),handleRemoveContractButtonClick(),handleRemoveContractConfirmButtonClick(),handleRemoveContractUserConfirmButtonClick(),handleViewUserDetailsButton(),handleViewUserProfileButtonClick(),handleDeleteUserContractLinkButtonClick(),handleUserCreation()};var handleUserCreation=function(){addUserButton.click((function(){if(selectedUserInput.get(0).setCustomValidity(""),newContractUserInputs.every((function(input){return input.get(0).reportValidity()}))){if(!selectedUserToBeCreated)return selectedUserInput.get(0).setCustomValidity("Este usuario no existe."),void selectedUserInput.get(0).reportValidity();var args={userId:selectedUserToBeCreated.id,contractId:contractSelectInput.val(),courseIds:coursesSelectInput.val().join(",")};Ajax.call([{methodname:"local_grupomakro_create_contract_user",args:args}])[0].done((function(response){if(-1===response.institutionContractId)return errorModalContent.html('<p class="text-center">'.concat(response.message,"</p>")),void errorModal.modal("show");window.location.reload()})).fail((function(error){console.error(error)}))}})),selectedUserInput.on("input",(function(){if((0,_jquery.default)(".contract-inserted-value").remove(),selectedUserToBeCreated=availableUsers.find((function(user){return user.username===selectedUserInput.val()}))){var selectedUserToBeCreatedContractInfo=selectedInstitutionContractUsers[selectedUserToBeCreated.id],availableContractsForSelectedUser=selectedUserToBeCreatedContractInfo?institutionContracts.filter((function(contract){return!selectedUserToBeCreatedContractInfo.contracts.some((function(userContract){return userContract.id===contract.id}))})):institutionContracts,contractListOptions="";availableContractsForSelectedUser.forEach((function(contractOption){contractListOptions+='<option class="contract-inserted-value" value="'.concat(contractOption.id,'">').concat(contractOption.contractId,"</option>")})),contractSelectInput.removeAttr("disabled"),contractSelectInput.html(contractSelectInput.html()+contractListOptions)}else contractSelectInput.prop("disabled",!0)}))},handleDeleteUserContractLinkButtonClick=function(){(0,_jquery.default)(".delete-contract-user-link").click((function(event){selectedContractUserId=event.currentTarget.attributes["contract-user-id"].value,confirmContractUserDeletionModal.modal("show")}))},handleRemoveContractUserConfirmButtonClick=function(){confirmContractUserDeletionButton.click((function(){if(selectedContractUserId){var args={id:selectedContractUserId};Ajax.call([{methodname:"local_grupomakro_delete_contract_user",args:args}])[0].done((function(response){if(-1===response.deletedContractUserId)return confirmContractUserDeletionModal.modal("hide"),errorModalContent.html('<p class="text-center">'.concat(response.message,"</p>")),void errorModal.modal("show");window.location.reload()})).fail((function(error){console.error(error)}))}}))},handleViewUserProfileButtonClick=function(){viewUserProfileButton.click((function(){window.open(selectedUser.profileUrl,"blank")}))},handleCreateContractButtonClick=function(){createContractButton.click((function(){window.location.href="/local/grupomakro_core/pages/createcontractinstitutional.php?id=".concat(selectedInstitutionId)}))},handleRemoveContractButtonClick=function(){removeContractButtons.click((function(event){selectedContractId=event.currentTarget.attributes["contract-id"].value}))},handleRemoveContractConfirmButtonClick=function(){removeContractConfirmButton.click((function(){var args={id:selectedContractId};Ajax.call([{methodname:"local_grupomakro_delete_institution_contract",args:args}])[0].done((function(response){if(-1===response.deletedInstitutionContractId)return confirmContractDeletionModal.modal("hide"),errorModalContent.html('<p class="text-center">'.concat(response.message,"</p>")),void errorModal.modal("show");window.location.reload()})).fail((function(error){console.error(error)}))}))},handleViewUserDetailsButton=function(){viewUserDetailsButtons.click((function(event){selectedUser=selectedInstitutionContractUsers[event.currentTarget.attributes["contract-user-id"].value],userInfoName.text(selectedUser.fullname),userInfoName.attr("href",selectedUser.profileUrl),userInfoEmail.text(selectedUser.email),userInfoAvatar.attr("src",selectedUser.avatar);var contractsHtmlString="";selectedUser.contracts.forEach((function(contract){contractsHtmlString+='\n            <li class="list-group-item d-flex justify-content-between align-items-center">\n                <div class="contracicon d-flex align-items-center">\n                    <img class="icon " alt="" aria-hidden="true" src="'.concat("https://grupomakro-dev.soluttolabs.com/theme/image.php?theme=soluttolmsadmin&amp;component=local_grupomakro_core&amp;image=t%2Fcontract",'">\n                    <span class="ml-2">').concat(contract.contractId,'</span>\n                </div>\n                <a href="#" class="text-secondary delete-contract-user-link" contract-user-id="').concat(contract.contractUserId,'">\n                    <i class="fa fa-trash" style="font-size:20px"></i>\n                </a>\n            </li>')})),userInfoContractList.html(contractsHtmlString),handleDeleteUserContractLinkButtonClick()}))}}));

//# sourceMappingURL=institutional_contracts.min.js.map