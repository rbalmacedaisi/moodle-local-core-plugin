{"version":3,"file":"create_class.min.js","sources":["../src/create_class.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nlet selectedInstance;\n\nconst typeSelector = $('#class_type');\nconst classNameInput = $('#classname')\nconst careerSelector = $('#career');\nconst periodSelector = $('#period');\nconst courseSelector = $('#courses');\nconst teacherSelector = $('#instructor');\nconst initTimeInput = $('#starttime');\nconst endTimeInput = $('#endtime');\nconst saveButton = $('#saveClassButton');\nconst mondaySwitch = $('#customSwitchMonday');\nconst tuesdaySwitch = $('#customSwitchTuesday');\nconst wednesdaySwitch = $('#customSwitchWednesday');\nconst thursdaySwitch = $('#customSwitchThursday');\nconst fridaySwitch = $('#customSwitchFriday');\nconst saturdaySwitch = $('#customSwitchSaturday');\nconst sundaySwitch = $('#customSwitchSunday');\nconst errorModal = $('#errorModal');\nconst errorModalContent = $('#error-modal-content');\nconst selectors = [ typeSelector, careerSelector, periodSelector, courseSelector, teacherSelector,classNameInput, initTimeInput, endTimeInput];\nconst switches = [mondaySwitch, tuesdaySwitch, wednesdaySwitch, thursdaySwitch, fridaySwitch, saturdaySwitch, sundaySwitch];\n\nlet periods;\nlet courses;\nlet teachers;\n\nconst instanceIDs = {\n    isi_panama: 0,\n    grupomakro_col: 1,\n    grupomakro_mex: 2\n};\n\nexport const init = () => {\n    handleInstanceSelection();\n    handleCareerSelection();\n    handlePeriodSelection();\n    handleCourseSelection();\n    handleClassSave();\n};\n\n\n\nconst handleClassSave = () => {\n    saveButton.click(()=>{\n        endTimeInput.get(0).setCustomValidity('');\n        mondaySwitch.get(0).setCustomValidity('');\n        // Check the select inputs and the time inputs\n        const valid = selectors.every(selector => {\n            return selector.get(0).reportValidity();\n        });\n        if (!valid) {\n            return;\n        }\n        //\n        // Check if the init time is less than the end time of the class\n        if (initTimeInput.val() >= endTimeInput.val()) {\n            endTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            endTimeInput.get(0).reportValidity();\n            return;\n        }\n        //\n        // Check if at least one day of the week is selected\n        const daySelected = switches.some(day => {\n            return day.is(\":checked\");\n        });\n        if (!daySelected) {\n            mondaySwitch.get(0).setCustomValidity('Se debe seleccionar al menos un día de clase.');\n            mondaySwitch.get(0).reportValidity();\n            return;\n        }\n        //\n        const args = {\n            name: classNameInput.val(),\n            type: typeSelector.val(),\n            instance: instanceIDs[selectedInstance],\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val(),\n            courseId: courseSelector.val(),\n            instructorId: teacherSelector.val(),\n            initTime: initTimeInput.val(),\n            endTime: endTimeInput.val(),\n            classDays: formatSelectedClassDays()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_create_class',\n            args\n        }, ]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if(response.status === -1 ){\n                // Add the error message to the modal content.\n                try{\n                    const errorMessages = JSON.parse(response.message);\n                    let errorHTMLString = '';\n                    errorMessages.forEach(message=>{\n                        errorHTMLString += `<p class=\"text-center\">${message}</p>`\n                    })\n                    errorModalContent.html(errorHTMLString);\n                }catch (error){\n                    errorModalContent.html(`<p class=\"text-center\">${response.message}</p>`);\n                } finally{\n                    errorModal.modal('show');\n                    return\n                }\n            } \n            window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n\n    });\n};\n\nconst handleInstanceSelection = () => {\n    $('a.company-instance').click(function() {\n        $('.form-check .card').removeClass('active');\n        $(this).parent('.form-check').find('input').click();\n        $(this).find('.card').addClass('active');\n        selectedInstance = $('input:radio:checked').val();\n        $('#fields-groups').removeClass('d-none');\n        console.log(selectedInstance)\n    });\n};\n\nconst handleCareerSelection = ()=> {\n    careerSelector.change(()=> {\n        if (careerSelector.val() === '') {\n            return;\n        }\n        const args = {\n            learningPlanId: careerSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_periods',\n            args\n        }, ]);\n        promise[0].done(function(response) {\n            $(\".periodValue\").remove();\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n\n            periods = JSON.parse(response.periods);\n            if (!periods.length) {\n                periodSelector.val('').change();\n                return;\n            }\n            periods.forEach(({id, name}) => {\n                periodSelector.append(`<option class=\"periodValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n\n};\n\nconst handlePeriodSelection = () => {\n    periodSelector.change(()=> {\n        if (periodSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_courses',\n            args\n        },]);\n        promise[0].done(function(response) {\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n            courses = JSON.parse(response.courses);\n            if (!courses.length) {\n                courseSelector.val('').change();\n                return;\n            }\n            courses.forEach(({id, name}) => {\n                courseSelector.append(`<option class=\"courseValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst handleCourseSelection = () => {\n    courseSelector.change(()=> {\n        if (courseSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            // periodId: periodSelector.val(),\n            // courseId: courseSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_teachers',\n            args\n        },]);\n        promise[0].done(function(response) {\n            $(\".teacherValue\").remove();\n            teachers = JSON.parse(response.teachers);\n            if (!teachers.length) {\n                teacherSelector.val('').change();\n                return;\n            }\n            teacherSelector.prop('disabled', false);\n            teachers.forEach(({userid, fullname, email}) => {\n                teacherSelector.append(`<option class=\"teacherValue\" value=\"${userid}\">${fullname} (${email})</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst formatSelectedClassDays = ()=> {\n    let daysString = '';\n    switches.forEach(day => {\n        daysString += `${day.is(\":checked\") ? 1 : 0}/`;\n    });\n    return daysString.substring(0, daysString.length - 1);\n};\n"],"names":["selectedInstance","periods","courses","teachers","typeSelector","classNameInput","careerSelector","periodSelector","courseSelector","teacherSelector","initTimeInput","endTimeInput","saveButton","mondaySwitch","tuesdaySwitch","wednesdaySwitch","thursdaySwitch","fridaySwitch","saturdaySwitch","sundaySwitch","errorModal","errorModalContent","selectors","switches","instanceIDs","isi_panama","grupomakro_col","grupomakro_mex","handleInstanceSelection","handleCareerSelection","handlePeriodSelection","handleCourseSelection","handleClassSave","click","get","setCustomValidity","every","selector","reportValidity","val","some","day","is","args","name","type","instance","learningPlanId","periodId","courseId","instructorId","initTime","endTime","classDays","formatSelectedClassDays","Ajax","call","methodname","done","response","window","console","log","status","errorMessages","JSON","parse","message","errorHTMLString","forEach","html","error","modal","location","href","fail","removeClass","this","parent","find","addClass","change","remove","length","id","append","prop","userid","fullname","email","daysString","substring"],"mappings":"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"}