{"version":3,"file":"create_class.min.js","sources":["../src/create_class.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nlet selectedInstance;\n\nconst typeSelector = $('#classtype');\nconst classroomSelector = $('#classroom');\nconst classNameInput = $('#classname');\nconst careerSelector = $('#career');\nconst periodSelector = $('#period');\nconst courseSelector = $('#courses');\nconst teacherSelector = $('#instructor');\nconst initTimeInput = $('#starttime');\nconst endTimeInput = $('#endtime');\nconst saveButton = $('#saveClassButton');\nconst mondaySwitch = $('#customSwitchMonday');\nconst tuesdaySwitch = $('#customSwitchTuesday');\nconst wednesdaySwitch = $('#customSwitchWednesday');\nconst thursdaySwitch = $('#customSwitchThursday');\nconst fridaySwitch = $('#customSwitchFriday');\nconst saturdaySwitch = $('#customSwitchSaturday');\nconst sundaySwitch = $('#customSwitchSunday');\nconst errorModal = $('#errorModal');\nconst errorModalContent = $('#error-modal-content');\nconst selectors = [typeSelector, careerSelector, periodSelector, courseSelector, classNameInput, initTimeInput, endTimeInput, classroomSelector];\nconst switches = [mondaySwitch, tuesdaySwitch, wednesdaySwitch, thursdaySwitch, fridaySwitch, saturdaySwitch, sundaySwitch];\n\nlet periods;\nlet courses;\nlet teachers;\nlet classRooms;\n\nconst instanceIDs = {\n    isi_panama: 0,\n    grupomakro_col: 1,\n    grupomakro_mex: 2\n};\n\nexport const init = (classrooms) => {\n    classRooms = JSON.parse(classrooms);\n    handleInstanceSelection();\n    handleCareerSelection();\n    handlePeriodSelection();\n    handleClassSave();\n    handleTypeSelector();\n};\n\nconst handleTypeSelector = () => {\n    typeSelector.change(()=>{\n        let classroomSelectorContainer = $(\"#classroom-fieldset\");\n        if (typeSelector.val() === '0' || typeSelector.val() === '2') {\n            classroomSelector.prop('required', true);\n            classroomSelectorContainer.removeClass(\"d-none\");\n        } else if (typeSelector.val() === '1') {\n            classroomSelector.removeAttr('required');\n            classroomSelectorContainer.addClass(\"d-none\");\n        }\n    });\n};\n\nconst handleClassSave = () => {\n    saveButton.click(()=>{\n        \n        console.log('entro')\n        endTimeInput.get(0).setCustomValidity('');\n        mondaySwitch.get(0).setCustomValidity('');\n        // Check the select inputs and the time inputs\n        const valid = selectors.every(selector => {\n            return selector.get(0).reportValidity();\n        });\n        if (!valid) {\n            console.error('algun selector esta mal')\n            return;\n        }\n        //\n        // Check if the init time is less than the end time of the class\n        if (initTimeInput.val() >= endTimeInput.val()) {\n            endTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            endTimeInput.get(0).reportValidity();\n            console.error('el tiempo esta mal')\n            return;\n        }\n        //\n        // Check if at least one day of the week is selected\n        const daySelected = switches.some(day => {\n            return day.is(\":checked\");\n        });\n        if (!daySelected) {\n            mondaySwitch.get(0).setCustomValidity('Se debe seleccionar al menos un día de clase.');\n            mondaySwitch.get(0).reportValidity();\n            console.error('algun dia esta mal')\n            return;\n        }\n        //\n        const instructorId = document.getElementById('instructorId')\n        if(instructorId.value == ''){\n            console.error('no hay id de instructor')\n            return;\n        }\n        const args = {\n            name: classNameInput.val(),\n            type: typeSelector.val(),\n            instance: instanceIDs[selectedInstance],\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val(),\n            courseId: courseSelector.val(),\n            instructorId: instructorId.value,\n            initTime: initTimeInput.val(),\n            endTime: endTimeInput.val(),\n            classDays: formatSelectedClassDays(),\n            classroomId: classroomSelector.val(),\n            classroomCapacity: classroomSelector.val()\n                ? classRooms.find(classroom => classroom.value == classroomSelector.val()).capacity\n                : 40\n        };\n        console.error(args)\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_create_class',\n            args\n        }]);\n        promise[0].done(function(response) {\n            if (response.status === -1) {\n                // Add the error message to the modal content.\n                try {\n                    const errorMessages = JSON.parse(response.message);\n                    let errorHTMLString = '';\n                    errorMessages.forEach(message=>{\n                        errorHTMLString += `<p class=\"text-center\">${message}</p>`;\n                    });\n                    errorModalContent.html(errorHTMLString);\n                } catch (error) {\n                    errorModalContent.html(`<p class=\"text-center\">${response.message}</p>`);\n                } finally {\n                    errorModal.modal('show');\n                }\n                return\n            }\n            window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n        }).fail(function(error) {\n           window.console.error(error);\n        });\n\n    });\n};\n\nconst handleInstanceSelection = () => {\n    $('a.company-instance').click(function() {\n        $('.form-check .card').removeClass('active');\n        $(this).parent('.form-check').find('input').click();\n        $(this).find('.card').addClass('active');\n        selectedInstance = $('input:radio:checked').val();\n        $('#fields-groups').removeClass('d-none');\n    });\n};\n\nconst handleCareerSelection = ()=> {\n    careerSelector.change(()=> {\n        if (careerSelector.val() === '') {\n            return;\n        }\n        const args = {\n            learningPlanId: careerSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_periods',\n            args\n        }]);\n        promise[0].done(function(response) {\n            $(\".periodValue\").remove();\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n\n            periods = JSON.parse(response.periods);\n            if (!periods.length) {\n                periodSelector.val('').change();\n                return;\n            }\n            periods.forEach(({id, name}) => {\n                periodSelector.append(`<option class=\"periodValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n           window.console.error(response);\n        });\n    });\n\n};\n\nconst handlePeriodSelection = () => {\n    periodSelector.change(()=> {\n        if (periodSelector.val() === '') {\n            return;\n        }\n        const args = {\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_courses',\n            args\n        }]);\n        promise[0].done(function(response) {\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n            courses = JSON.parse(response.courses);\n            if (!courses.length) {\n                courseSelector.val('').change();\n                return;\n            }\n            courses.forEach(({id, name}) => {\n                courseSelector.append(`<option class=\"courseValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n           window.console.error(response);\n        });\n    });\n};\n\n\nconst formatSelectedClassDays = ()=> {\n    let daysString = '';\n    switches.forEach(day => {\n        daysString += `${day.is(\":checked\") ? 1 : 0}/`;\n    });\n    return daysString.substring(0, daysString.length - 1);\n};\n\n"],"names":["selectedInstance","typeSelector","classroomSelector","classNameInput","careerSelector","periodSelector","courseSelector","initTimeInput","endTimeInput","saveButton","mondaySwitch","tuesdaySwitch","wednesdaySwitch","thursdaySwitch","fridaySwitch","saturdaySwitch","sundaySwitch","errorModal","errorModalContent","selectors","switches","periods","courses","classRooms","instanceIDs","isi_panama","grupomakro_col","grupomakro_mex","classrooms","JSON","parse","handleInstanceSelection","handleCareerSelection","handlePeriodSelection","handleClassSave","handleTypeSelector","change","classroomSelectorContainer","val","prop","removeClass","removeAttr","addClass","click","console","log","get","setCustomValidity","every","selector","reportValidity","error","some","day","is","instructorId","document","getElementById","value","args","name","type","instance","learningPlanId","periodId","courseId","initTime","endTime","classDays","formatSelectedClassDays","classroomId","classroomCapacity","find","classroom","capacity","Ajax","call","methodname","done","response","status","window","location","href","errorMessages","message","errorHTMLString","forEach","html","modal","fail","this","parent","remove","length","_ref","id","append","_ref2","daysString","substring"],"mappings":"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"}