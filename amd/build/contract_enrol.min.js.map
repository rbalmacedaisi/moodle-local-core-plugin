{"version":3,"file":"contract_enrol.min.js","sources":["../src/contract_enrol.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nconst errorModal = $('#errorModal');\nconst errorModalContent = $('#error-modal-content');\n\nconst documentCheckInputHolder = $('#document-check-input');\nconst userCheckIdentificationNumberInput = $('#userCheckIdentificationNumber');\nconst enrolButton = $('#enrolButton');\nconst userNotFoundModal = $('#userNotFoundModal');\nconst enrolCreateAccountButton = $('#enrolCreateAccountButton');\n\nconst createAccountInputsHolder = $('#create-user-inputs');\nconst createUserIdentificationNumberInput = $('#userIdentificationNumber');\nconst createUserFirstNameInput = $('#userFirstName');\nconst createUserLastNameInput = $('#userLastName');\nconst createUserEmailInput = $('#userEmail');\n\nconst createUserInputs = [createUserIdentificationNumberInput,createUserFirstNameInput,createUserLastNameInput,createUserEmailInput];\n\nlet enrolCourseId,enrolContractId,creatingAccount = false;\n\nconst webserviceUrl = 'https://grupomakro-dev.soluttolabs.com/webservice/rest/server.php?wstoken=33513bec0b3469194c7756c29bf9fb33&moodlewsrestformat=json&wsfunction=';\nconst fetchParams = {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n    }\n\nexport const init = async (courseId,contractId) => {\n    [enrolCourseId,enrolContractId] = [courseId,contractId];\n    handleEnrolButtonClick();\n    handleEnrolCreateAccountButtonClick()\n};\nconst handleEnrolCreateAccountButtonClick = () => {\n    enrolCreateAccountButton.click(()=>{\n        creatingAccount = true;\n        documentCheckInputHolder.hide();\n        userNotFoundModal.modal('hide');\n        createAccountInputsHolder.show();\n    })\n}\n\nconst handleEnrolButtonClick = () => {\n    enrolButton.click(async ()=>{\n        if(!creatingAccount){\n            if(!userCheckIdentificationNumberInput.get(0).reportValidity()) return;\n            const params = new URLSearchParams();\n            params.append('field', 'username');\n            params.append('values[0]', userCheckIdentificationNumberInput.val());\n            try {\n                // First,check if the user exists\n                let response = await window.fetch(webserviceUrl+'core_user_get_users_by_field&'+params, fetchParams)\n                if (!response.ok) {\n                  throw new Error('Request failed with status: ' + response.status);\n                }\n                response = await response.json();\n                if (!response.length) {\n                    userNotFoundModal.modal('show');\n                    return;\n                }\n                return enrolContractUser(response[0].id);\n                \n            \n            } catch (error) {\n                errorModalContent.html(`<p class=\"text-center\">${error.message}</p>`);\n                errorModal.modal('show');\n                console.error(error);\n                \n            } finally{\n                return;\n            }\n        }\n        \n        // Check the create user inputs\n        const valid = createUserInputs.every(input => {\n            return input.get(0).reportValidity();\n        });\n        if (!valid) {\n            return;\n        }\n        const args = {\n            users: [{\n                username:createUserIdentificationNumberInput.val(),\n                firstname:createUserFirstNameInput.val(),\n                lastname:createUserLastNameInput.val(),\n                email:createUserEmailInput.val()\n            }]\n            \n        };\n        try {\n            const response = await Ajax.call([\n                {\n                    methodname: 'core_user_create_users',\n                    args,\n                },\n            ])[0];\n            console.log(response)\n        } catch (error){\n            errorModalContent.html(`<p class=\"text-center\">${error.message}</p>`);\n            errorModal.modal('show');\n            console.error(error);\n        }\n        //\n    })\n} \n\nconst enrolContractUser = async (userId) => {\n    const params = new URLSearchParams();\n    params.append('userId', userId);\n    params.append('contractId', enrolContractId);\n    params.append('courseIds', enrolCourseId);\n    try{\n        let response = await window.fetch(webserviceUrl+'local_grupomakro_create_contract_user&'+params, fetchParams)\n        if (!response.ok) {\n            throw new Error('Request failed with status: ' + response.status);\n        }\n        response = await response.json();\n        if(response.contractUserId ===-1)throw response.message;\n        console.log('bien');\n        \n    }catch (error){\n        errorModalContent.html(`<p class=\"text-center\">${error}</p>`);\n        errorModal.modal('show');\n        console.error(error);\n    }finally{\n        return;\n    }\n    \n}\n"],"names":["enrolCourseId","enrolContractId","errorModal","errorModalContent","documentCheckInputHolder","userCheckIdentificationNumberInput","enrolButton","userNotFoundModal","enrolCreateAccountButton","createAccountInputsHolder","createUserIdentificationNumberInput","createUserFirstNameInput","createUserLastNameInput","createUserEmailInput","createUserInputs","creatingAccount","webserviceUrl","fetchParams","method","headers","init","courseId","contractId","handleEnrolButtonClick","handleEnrolCreateAccountButtonClick","click","hide","modal","show","get","reportValidity","params","URLSearchParams","append","val","window","fetch","response","ok","Error","status","json","length","enrolContractUser","id","html","_context2","message","console","error","every","input","args","users","username","firstname","lastname","email","Ajax","call","methodname","log","userId","contractUserId"],"mappings":"i7DAoBIA,cAAcC,qBAjBZC,YAAa,qEAAE,eACfC,mBAAoB,mBAAE,wBAEtBC,0BAA2B,mBAAE,yBAC7BC,oCAAqC,mBAAE,kCACvCC,aAAc,mBAAE,gBAChBC,mBAAoB,mBAAE,sBACtBC,0BAA2B,mBAAE,6BAE7BC,2BAA4B,mBAAE,uBAC9BC,qCAAsC,mBAAE,6BACxCC,0BAA2B,mBAAE,kBAC7BC,yBAA0B,mBAAE,iBAC5BC,sBAAuB,mBAAE,cAEzBC,iBAAmB,CAACJ,oCAAoCC,yBAAyBC,wBAAwBC,sBAE7EE,iBAAkB,EAE9CC,cAAgB,iJAChBC,YAAc,CACZC,OAAQ,OACRC,QAAS,gBACW,qBAIfC,sDAAO,iBAAOC,SAASC,iHAC/BtB,cAAkCqB,SAApBpB,gBAA6BqB,WAC5CC,yBACAC,gLAEEA,oCAAsC,WACxChB,yBAAyBiB,OAAM,WAC3BV,iBAAkB,EAClBX,yBAAyBsB,OACzBnB,kBAAkBoB,MAAM,QACxBlB,0BAA0BmB,WAI5BL,uBAAyB,WAC3BjB,YAAYmB,iDAAM,kKACVV,4CACIV,mCAAmCwB,IAAI,GAAGC,yFACxCC,OAAS,IAAIC,iBACZC,OAAO,QAAS,YACvBF,OAAOE,OAAO,YAAa5B,mCAAmC6B,yCAGrCC,OAAOC,MAAMpB,cAAc,gCAAgCe,OAAQd,wBAApFoB,yBACUC,kCACN,IAAIC,MAAM,+BAAiCF,SAASG,yCAE3CH,SAASI,mBAA1BJ,yBACcK,uCACVnC,kBAAkBoB,MAAM,4EAGrBgB,kBAAkBN,SAAS,GAAGO,+DAIrCzC,kBAAkB0C,sCAA+BC,aAAMC,iBACvD7C,WAAWyB,MAAM,QACjBqB,QAAQC,2FAQFnC,iBAAiBoC,OAAM,SAAAC,cAC1BA,MAAMtB,IAAI,GAAGC,8FAKlBsB,KAAO,CACTC,MAAO,CAAC,CACJC,SAAS5C,oCAAoCwB,MAC7CqB,UAAU5C,yBAAyBuB,MACnCsB,SAAS5C,wBAAwBsB,MACjCuB,MAAM5C,qBAAqBqB,6CAKRwB,KAAKC,KAAK,CAC7B,CACIC,WAAY,yBACZR,KAAAA,QAEL,WALGf,yBAMNW,QAAQa,IAAIxB,8FAEZlC,kBAAkB0C,sCAA+BC,aAAMC,iBACvD7C,WAAWyB,MAAM,QACjBqB,QAAQC,6GAMdN,oEAAoB,kBAAOmB,2IACvB/B,OAAS,IAAIC,iBACZC,OAAO,SAAU6B,QACxB/B,OAAOE,OAAO,aAAchC,iBAC5B8B,OAAOE,OAAO,YAAajC,iDAEFmC,OAAOC,MAAMpB,cAAc,yCAAyCe,OAAQd,wBAA7FoB,yBACUC,kCACJ,IAAIC,MAAM,+BAAiCF,SAASG,yCAE7CH,SAASI,mBACK,KAD/BJ,yBACY0B,8CAA2B1B,SAASU,gBAChDC,QAAQa,IAAI,0FAGZ1D,kBAAkB0C,4DAClB3C,WAAWyB,MAAM,QACjBqB,QAAQC"}