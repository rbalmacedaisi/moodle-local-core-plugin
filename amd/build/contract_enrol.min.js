function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("local_grupomakro_core/contract_enrol",["exports","core/ajax","jquery"],(function(_exports,Ajax,_jquery){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Ajax);var enrolCourseId,enrolContractId,webserviceUrl,_ref,errorModal=(0,(_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj}).default)("#errorModal"),errorModalContent=(0,_jquery.default)("#error-modal-content"),documentCheckInputHolder=(0,_jquery.default)("#document-check-input"),userCheckIdentificationNumberInput=(0,_jquery.default)("#userCheckIdentificationNumber"),enrolButton=(0,_jquery.default)("#enrolButton"),userNotFoundModal=(0,_jquery.default)("#userNotFoundModal"),enrolCreateAccountButton=(0,_jquery.default)("#enrolCreateAccountButton"),createAccountInputsHolder=(0,_jquery.default)("#create-user-inputs"),createUserIdentificationNumberInput=(0,_jquery.default)("#userIdentificationNumber"),createUserFirstNameInput=(0,_jquery.default)("#userFirstName"),createUserLastNameInput=(0,_jquery.default)("#userLastName"),createUserEmailInput=(0,_jquery.default)("#userEmail"),createUserInputs=[createUserIdentificationNumberInput,createUserFirstNameInput,createUserLastNameInput,createUserEmailInput],creatingAccount=!1,fetchParams={method:"POST",headers:{"Content-Type":"application/json"}},init=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(courseId,contractId,wsUrl){return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:webserviceUrl=wsUrl,enrolCourseId=courseId,enrolContractId=contractId,handleEnrolButtonClick(),handleEnrolCreateAccountButtonClick();case 5:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2,_x3){return _ref.apply(this,arguments)});_exports.init=init;var _ref3,handleEnrolCreateAccountButtonClick=function(){enrolCreateAccountButton.click((function(){creatingAccount=!0,documentCheckInputHolder.hide(),createUserIdentificationNumberInput.val(userCheckIdentificationNumberInput.val()),userNotFoundModal.modal("hide"),createAccountInputsHolder.show()}))},handleEnrolButtonClick=function(){enrolButton.click(_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var _params,response,params,_response;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(creatingAccount){_context2.next=29;break}if(userCheckIdentificationNumberInput.get(0).reportValidity()){_context2.next=3;break}return _context2.abrupt("return");case 3:return(_params=new URLSearchParams).append("field","username"),_params.append("values[0]",userCheckIdentificationNumberInput.val()),_context2.prev=6,_context2.next=9,window.fetch(webserviceUrl+"core_user_get_users_by_field&"+_params,fetchParams);case 9:if((response=_context2.sent).ok){_context2.next=12;break}throw new Error("Request failed with status: "+response.status);case 12:return _context2.next=14,response.json();case 14:if((response=_context2.sent).length){_context2.next=18;break}return userNotFoundModal.modal("show"),_context2.abrupt("return");case 18:return _context2.abrupt("return",enrolContractUser(response[0].id));case 21:_context2.prev=21,_context2.t0=_context2.catch(6),errorModalContent.html('<p class="text-center">'.concat(_context2.t0.message,"</p>")),errorModal.modal("show"),console.error(_context2.t0);case 26:return _context2.prev=26,_context2.abrupt("return");case 29:if(createUserInputs.every((function(input){return input.get(0).reportValidity()}))){_context2.next=32;break}return _context2.abrupt("return");case 32:return(params=new URLSearchParams).append("username",createUserIdentificationNumberInput.val()),params.append("firstname",createUserFirstNameInput.val()),params.append("lastname",createUserLastNameInput.val()),params.append("email",createUserEmailInput.val()),params.append("contractId",enrolContractId),params.append("courseId",enrolCourseId),_context2.prev=39,_context2.next=42,window.fetch(webserviceUrl+"local_grupomakro_create_student_user&"+params,fetchParams);case 42:if((_response=_context2.sent).ok){_context2.next=45;break}throw new Error("Request failed with status: "+_response.status);case 45:return _context2.next=47,_response.json();case 47:if(-1!==(_response=_context2.sent).contractEnrolResult){_context2.next=50;break}throw _response.message;case 50:setTimeout((function(){window.location.href="https://students-lxp-dev.soluttolabs.com/login"}),5e3),_context2.next=58;break;case 53:_context2.prev=53,_context2.t1=_context2.catch(39),errorModalContent.html('<p class="text-center">'.concat(_context2.t1,"</p>")),errorModal.modal("show"),console.error(_context2.t1);case 58:return _context2.prev=58,_context2.abrupt("return");case 61:case"end":return _context2.stop()}}),_callee2,null,[[6,21,26,29],[39,53,58,61]])}))))},enrolContractUser=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(userId){var params,response,parsedResponse;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return(params=new URLSearchParams).append("userId",userId),params.append("contractId",enrolContractId),params.append("courseIds",enrolCourseId),_context3.prev=4,_context3.next=7,window.fetch(webserviceUrl+"local_grupomakro_create_contract_user&"+params,fetchParams);case 7:if((response=_context3.sent).ok){_context3.next=10;break}throw new Error("Request failed with status: "+response.status);case 10:return _context3.next=12,response.json();case 12:if(-1!==(response=_context3.sent).contractUserId){_context3.next=15;break}throw response.message;case 15:if(response.result){_context3.next=17;break}throw response.message;case 17:if((parsedResponse=JSON.parse(response.result)).success.length){_context3.next=20;break}throw parsedResponse.failure[0].message;case 20:setTimeout((function(){window.location.href="https://students-lxp-dev.soluttolabs.com/login"}),5e3),_context3.next=27;break;case 23:_context3.prev=23,_context3.t0=_context3.catch(4),errorModalContent.html('<p class="text-center">'.concat(_context3.t0,"</p>")),errorModal.modal("show");case 27:return _context3.prev=27,_context3.abrupt("return");case 30:case"end":return _context3.stop()}}),_callee3,null,[[4,23,27,30]])}))),function(_x4){return _ref3.apply(this,arguments)})}));

//# sourceMappingURL=contract_enrol.min.js.map