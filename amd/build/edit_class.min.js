function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("local_grupomakro_core/edit_class",["exports","core/ajax","jquery"],(function(_exports,Ajax,_jquery){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Ajax);var periods,courses,teachers,classNameInput=(0,(_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj}).default)("#classname"),typeSelector=(0,_jquery.default)("#class_type"),careerSelector=(0,_jquery.default)("#career"),periodSelector=(0,_jquery.default)("#period"),courseSelector=(0,_jquery.default)("#courses"),teacherSelector=(0,_jquery.default)("#instructor"),initTimeInput=(0,_jquery.default)("#starttime"),endTimeInput=(0,_jquery.default)("#endtime"),newDateInput=(0,_jquery.default)("#newDate"),newStartTimeInput=(0,_jquery.default)("#newStartTime"),newEndTimeInput=(0,_jquery.default)("#newEndTime"),saveButton=(0,_jquery.default)("#saveClassButton"),rescheduleButton=(0,_jquery.default)("#rescheduleActivityButton"),confirmRescheduleButton=(0,_jquery.default)("#confirmRescheduleActivity"),mondaySwitch=(0,_jquery.default)("#customSwitchMonday"),tuesdaySwitch=(0,_jquery.default)("#customSwitchTuesday"),wednesdaySwitch=(0,_jquery.default)("#customSwitchWednesday"),thursdaySwitch=(0,_jquery.default)("#customSwitchThursday"),fridaySwitch=(0,_jquery.default)("#customSwitchFriday"),saturdaySwitch=(0,_jquery.default)("#customSwitchSaturday"),sundaySwitch=(0,_jquery.default)("#customSwitchSunday"),rescheduleConfirmationText=(0,_jquery.default)("#confirmationTextHolder"),selectors=[classNameInput,typeSelector,careerSelector,periodSelector,courseSelector,teacherSelector,initTimeInput,endTimeInput],switches=[mondaySwitch,tuesdaySwitch,wednesdaySwitch,thursdaySwitch,fridaySwitch,saturdaySwitch,sundaySwitch],classId=window.location.search.substring(10);_exports.init=function(reschedulingActivity){reschedulingActivity,handleCareerSelection(),handlePeriodSelection(),handleCourseSelection(),handleClassSave(),handleActivityReschedule(),handleActivityRescheduleConfirmation()};var handleActivityRescheduleConfirmation=function(){confirmRescheduleButton.click((function(){var searchParams=new URLSearchParams(window.location.search),args={classId:searchParams.get("class_id"),moduleId:searchParams.get("moduleId"),date:newDateInput.val(),initTime:newStartTimeInput.val(),endTime:newEndTimeInput.val(),sessionId:""!==searchParams.get("sessionId")?searchParams.get("sessionId"):null};Ajax.call([{methodname:"local_grupomakro_reschedule_activity",args:args}])[0].done((function(response){window.console.log(response),-1!==response.status?window.location.href="/local/grupomakro_core/pages/schedules.php":console.log(response.message)})).fail((function(error){window.console.error(error)}))}))},handleActivityReschedule=function(){rescheduleButton.click((function(){var searchParams=new URLSearchParams(window.location.search),args={classId:searchParams.get("class_id"),moduleId:searchParams.get("moduleId"),date:newDateInput.val(),initTime:newStartTimeInput.val(),endTime:newEndTimeInput.val(),sessionId:""!==searchParams.get("sessionId")?searchParams.get("sessionId"):null};console.log(args),Ajax.call([{methodname:"local_grupomakro_check_reschedule_conflicts",args:args}])[0].done((function(response){if(window.console.log(response),-1===response.status)return console.log(response.message),void(0,_jquery.default)("#confirmationTextHolder").html("<p>".concat(response.message,"</p>"));rescheduleConfirmationText.text(response.message)})).fail((function(error){window.console.error(error)}))}))},handleClassSave=function(){saveButton.click((function(){if(endTimeInput.get(0).setCustomValidity(""),selectors.every((function(selector){return selector.get(0).reportValidity()}))){if(initTimeInput.val()>=endTimeInput.val())return endTimeInput.get(0).setCustomValidity("La hora de finalización debe ser mayor a la hora de inicio."),void endTimeInput.get(0).reportValidity();if(!switches.some((function(day){return day.is(":checked")})))return mondaySwitch.get(0).setCustomValidity("Se debe seleccionar al menos un día de clase."),void mondaySwitch.get(0).reportValidity();var args={classId:classId,name:classNameInput.val(),type:typeSelector.val(),learningPlanId:careerSelector.val(),periodId:periodSelector.val(),courseId:courseSelector.val(),instructorId:teacherSelector.val(),initTime:initTimeInput.val(),endTime:endTimeInput.val(),classDays:formatSelectedClassDays()};console.log(args),Ajax.call([{methodname:"local_grupomakro_update_class",args:args}])[0].done((function(response){if(window.console.log(response),-1===response.status){console.log(response.message);var modal=(0,_jquery.default)("#errorModal");return modal.find(".modal-body").html('<p class="text-center">'.concat(response.message,"</p>")),modal.find(".modal-title").text("Error"),void modal.modal("show")}window.location.href="/local/grupomakro_core/pages/classmanagement.php"})).fail((function(error){window.console.error(error)}))}}))},handleCareerSelection=function(){careerSelector.change((function(){if(""!==careerSelector.val()){var args={learningPlanId:careerSelector.val()};Ajax.call([{methodname:"local_sc_learningplans_get_learning_plan_periods",args:args}])[0].done((function(response){(0,_jquery.default)(".periodValue").remove(),(0,_jquery.default)(".courseValue").remove(),(0,_jquery.default)(".teacherValue").remove(),(periods=JSON.parse(response.periods)).length?periods.forEach((function(_ref){var id=_ref.id,name=_ref.name;periodSelector.append('<option class="periodValue" value="'.concat(id,'">').concat(name,"</option>"))})):periodSelector.val("").change()})).fail((function(response){window.console.error(response)}))}}))},handlePeriodSelection=function(){periodSelector.change((function(){if(""!==periodSelector.val()){var args={learningPlanId:careerSelector.val(),periodId:periodSelector.val()};Ajax.call([{methodname:"local_sc_learningplans_get_learning_plan_courses",args:args}])[0].done((function(response){(0,_jquery.default)(".courseValue").remove(),(0,_jquery.default)(".teacherValue").remove(),(courses=JSON.parse(response.courses)).length?courses.forEach((function(_ref2){var id=_ref2.id,name=_ref2.name;courseSelector.append('<option class="courseValue" value="'.concat(id,'">').concat(name,"</option>"))})):courseSelector.val("").change()})).fail((function(response){window.console.error(response)}))}}))},handleCourseSelection=function(){courseSelector.change((function(){if(""!==courseSelector.val()){var args={learningPlanId:careerSelector.val()};Ajax.call([{methodname:"local_sc_learningplans_get_learning_plan_teachers",args:args}])[0].done((function(response){(0,_jquery.default)(".teacherValue").remove(),(teachers=JSON.parse(response.teachers)).length?(teacherSelector.prop("disabled",!1),teachers.forEach((function(_ref3){var id=_ref3.id,fullname=_ref3.fullname,email=_ref3.email;teacherSelector.append('<option class="teacherValue" value="'.concat(id,'">').concat(fullname," (").concat(email,")</option>"))}))):teacherSelector.val("").change()})).fail((function(response){window.console.error(response)}))}}))},formatSelectedClassDays=function(){var daysString="";return switches.forEach((function(day){daysString+="".concat(day.is(":checked")?1:0,"/")})),daysString.substring(0,daysString.length-1)}}));

//# sourceMappingURL=edit_class.min.js.map