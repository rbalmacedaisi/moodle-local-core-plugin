{"version":3,"file":"edit_class.min.js","sources":["../src/edit_class.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nconst classNameInput = $('#classname');\nconst typeSelector = $('#class_type');\nconst careerSelector = $('#career');\nconst periodSelector = $('#period');\nconst courseSelector = $('#courses');\nconst teacherSelector = $('#instructor');\nconst initTimeInput = $('#starttime');\nconst endTimeInput = $('#endtime');\nconst newDateInput = $('#newDate');\nconst newStartTimeInput = $('#newStartTime');\nconst newEndTimeInput = $('#newEndTime');\nconst saveButton = $('#saveClassButton');\nconst rescheduleButton = $('#rescheduleActivityButton');\nconst confirmRescheduleButton = $('#confirmRescheduleActivity');\nconst mondaySwitch = $('#customSwitchMonday');\nconst tuesdaySwitch = $('#customSwitchTuesday');\nconst wednesdaySwitch = $('#customSwitchWednesday');\nconst thursdaySwitch = $('#customSwitchThursday');\nconst fridaySwitch = $('#customSwitchFriday');\nconst saturdaySwitch = $('#customSwitchSaturday');\nconst sundaySwitch = $('#customSwitchSunday');\nconst rescheduleConfirmationText = $('#confirmationTextHolder');\nconst selectors = [classNameInput,typeSelector, careerSelector, periodSelector, courseSelector, teacherSelector, initTimeInput, endTimeInput];\nconst switches = [mondaySwitch, tuesdaySwitch, wednesdaySwitch, thursdaySwitch, fridaySwitch, saturdaySwitch, sundaySwitch];\nconst classId = window.location.search.substring(10,);\nlet rescheduling = undefined;\nlet periods;\nlet courses;\nlet teachers;\n\nexport const init = (reschedulingActivity) => {\n    rescheduling= reschedulingActivity;\n    handleCareerSelection();\n    handlePeriodSelection();\n    handleCourseSelection();\n    handleClassSave();\n    handleActivityReschedule();\n    handleActivityRescheduleConfirmation();\n};\n\n\nconst handleActivityRescheduleConfirmation = () => {\n    confirmRescheduleButton.click(()=>{\n        const searchParams = new URLSearchParams(window.location.search);\n        \n        const args = {\n            classId:searchParams.get('class_id'),\n            moduleId:searchParams.get('moduleId'),\n            date:newDateInput.val(),\n            initTime:newStartTimeInput.val(),\n            endTime:newEndTimeInput.val(),\n            sessionId:searchParams.get('sessionId')!==''?searchParams.get('sessionId'):null\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_reschedule_activity',\n            args\n        }, ]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if(response.status === -1 ){\n                console.log(response.message)\n                return\n            } \n            window.location.href = '/local/grupomakro_core/pages/schedules.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n    })\n}\n\nconst handleActivityReschedule = () => {\n    rescheduleButton.click(()=>{\n        const searchParams = new URLSearchParams(window.location.search);\n        \n        const args = {\n            classId:searchParams.get('class_id'),\n            moduleId:searchParams.get('moduleId'),\n            date:newDateInput.val(),\n            initTime:newStartTimeInput.val(),\n            endTime:newEndTimeInput.val(),\n            sessionId:searchParams.get('sessionId')!==''?searchParams.get('sessionId'):null\n        };\n        console.log(args)\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_check_reschedule_conflicts',\n            args\n        }, ]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if(response.status === -1 ){\n                console.log(response.message)\n                const modalContent = $('#confirmationTextHolder')\n                modalContent.html(`<p>${response.message}</p>`);\n                return\n            } \n            rescheduleConfirmationText.text( response.message);\n            // window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n    })\n}\n\nconst handleClassSave = () => {\n    saveButton.click(()=>{\n        \n        endTimeInput.get(0).setCustomValidity('');\n        // Check the select inputs and the time inputs\n        const valid = selectors.every(selector => {\n            return selector.get(0).reportValidity();\n        });\n        if (!valid) {\n            return;\n        }\n        //\n        \n        // Check if the init time is less than the end time of the class\n        if (initTimeInput.val() >= endTimeInput.val()) {\n            endTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            endTimeInput.get(0).reportValidity();\n            return;\n        }\n        //\n        \n        // Check if at least one day of the week is selected\n        const daySelected = switches.some(day => {\n            return day.is(\":checked\");\n        });\n        if (!daySelected) {\n            mondaySwitch.get(0).setCustomValidity('Se debe seleccionar al menos un día de clase.');\n            mondaySwitch.get(0).reportValidity();\n            return;\n        }\n        //\n        const args = {\n            classId,\n            name: classNameInput.val(),\n            type: typeSelector.val(),\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val(),\n            courseId: courseSelector.val(),\n            instructorId: teacherSelector.val(),\n            initTime: initTimeInput.val(),\n            endTime: endTimeInput.val(),\n            classDays: formatSelectedClassDays(),\n        };\n        console.log(args)\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_update_class',\n            args\n        }, ]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if(response.status === -1 ){\n                console.log(response.message)\n                // Get the modal element and its content.\n                const modal = $('#errorModal');\n                const modalContent = modal.find('.modal-body');\n                \n                // Add the error message to the modal content.\n                modalContent.html(`<p class=\"text-center\">${response.message}</p>`);\n                modal.find('.modal-title').text('Error');\n                modal.modal('show');\n                \n                return\n            }\n            window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n\n    });\n};\n\nconst handleCareerSelection = ()=> {\n    careerSelector.change(()=> {\n        if (careerSelector.val() === '') {\n return;\n}\nconst args = {\n    learningPlanId: careerSelector.val()\n};\nconst promise = Ajax.call([{\n    methodname: 'local_sc_learningplans_get_learning_plan_periods',\n        args\n}, ]);\n        promise[0].done(function(response) {\n            $(\".periodValue\").remove();\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n\n            periods = JSON.parse(response.periods);\n            if (!periods.length) {\n                periodSelector.val('').change();\n                return;\n            }\n            periods.forEach(({id, name}) => {\n                periodSelector.append(`<option class=\"periodValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n\n};\n\nconst handlePeriodSelection = () => {\n    periodSelector.change(()=> {\n        if (periodSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_courses',\n            args\n        },]);\n        promise[0].done(function(response) {\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n            courses = JSON.parse(response.courses);\n            if (!courses.length) {\n                courseSelector.val('').change();\n                return;\n            }\n            courses.forEach(({id, name}) => {\n                courseSelector.append(`<option class=\"courseValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst handleCourseSelection = () => {\n    courseSelector.change(()=> {\n        if (courseSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            // periodId: periodSelector.val(),\n            // courseId: courseSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_teachers',\n            args\n        },]);\n        promise[0].done(function(response) {\n            $(\".teacherValue\").remove();\n            teachers = JSON.parse(response.teachers);\n            if (!teachers.length) {\n                teacherSelector.val('').change();\n                return;\n            }\n            teacherSelector.prop('disabled', false);\n            teachers.forEach(({id, fullname, email}) => {\n                teacherSelector.append(`<option class=\"teacherValue\" value=\"${id}\">${fullname} (${email})</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst formatSelectedClassDays = ()=> {\n    let daysString = '';\n    switches.forEach(day => {\n        daysString += `${day.is(\":checked\") ? 1 : 0}/`;\n    });\n    return daysString.substring(0, daysString.length - 1);\n};"],"names":["periods","courses","teachers","classNameInput","typeSelector","careerSelector","periodSelector","courseSelector","teacherSelector","initTimeInput","endTimeInput","newDateInput","newStartTimeInput","newEndTimeInput","saveButton","rescheduleButton","confirmRescheduleButton","mondaySwitch","tuesdaySwitch","wednesdaySwitch","thursdaySwitch","fridaySwitch","saturdaySwitch","sundaySwitch","rescheduleConfirmationText","selectors","switches","classId","window","location","search","substring","reschedulingActivity","handleCareerSelection","handlePeriodSelection","handleCourseSelection","handleClassSave","handleActivityReschedule","handleActivityRescheduleConfirmation","click","searchParams","URLSearchParams","args","get","moduleId","date","val","initTime","endTime","sessionId","Ajax","call","methodname","done","response","console","log","status","href","message","fail","error","html","text","setCustomValidity","every","selector","reportValidity","some","day","is","name","type","learningPlanId","periodId","courseId","instructorId","classDays","formatSelectedClassDays","modal","find","change","remove","JSON","parse","length","forEach","id","append","prop","fullname","email","daysString"],"mappings":"63CA6BIA,QACAC,QACAC,SA5BEC,gBAAiB,qEAAE,cACnBC,cAAe,mBAAE,eACjBC,gBAAiB,mBAAE,WACnBC,gBAAiB,mBAAE,WACnBC,gBAAiB,mBAAE,YACnBC,iBAAkB,mBAAE,eACpBC,eAAgB,mBAAE,cAClBC,cAAe,mBAAE,YACjBC,cAAe,mBAAE,YACjBC,mBAAoB,mBAAE,iBACtBC,iBAAkB,mBAAE,eACpBC,YAAa,mBAAE,oBACfC,kBAAmB,mBAAE,6BACrBC,yBAA0B,mBAAE,8BAC5BC,cAAe,mBAAE,uBACjBC,eAAgB,mBAAE,wBAClBC,iBAAkB,mBAAE,0BACpBC,gBAAiB,mBAAE,yBACnBC,cAAe,mBAAE,uBACjBC,gBAAiB,mBAAE,yBACnBC,cAAe,mBAAE,uBACjBC,4BAA6B,mBAAE,2BAC/BC,UAAY,CAACtB,eAAeC,aAAcC,eAAgBC,eAAgBC,eAAgBC,gBAAiBC,cAAeC,cAC1HgB,SAAW,CAACT,aAAcC,cAAeC,gBAAiBC,eAAgBC,aAAcC,eAAgBC,cACxGI,QAAUC,OAAOC,SAASC,OAAOC,UAAU,kBAM7B,SAACC,sBACHA,qBACdC,wBACAC,wBACAC,wBACAC,kBACAC,2BACAC,4CAIEA,qCAAuC,WACzCtB,wBAAwBuB,OAAM,eACpBC,aAAe,IAAIC,gBAAgBb,OAAOC,SAASC,QAEnDY,KAAO,CACTf,QAAQa,aAAaG,IAAI,YACzBC,SAASJ,aAAaG,IAAI,YAC1BE,KAAKlC,aAAamC,MAClBC,SAASnC,kBAAkBkC,MAC3BE,QAAQnC,gBAAgBiC,MACxBG,UAA0C,KAAhCT,aAAaG,IAAI,aAAkBH,aAAaG,IAAI,aAAa,MAE/DO,KAAKC,KAAK,CAAC,CACvBC,WAAY,uCACZV,KAAAA,QAEI,GAAGW,MAAK,SAASC,UACrB1B,OAAO2B,QAAQC,IAAIF,WACK,IAArBA,SAASG,OAIZ7B,OAAOC,SAAS6B,KAAO,6CAHnBH,QAAQC,IAAIF,SAASK,YAI1BC,MAAK,SAASC,OACbjC,OAAO2B,QAAQM,MAAMA,cAK3BxB,yBAA2B,WAC7BtB,iBAAiBwB,OAAM,eACbC,aAAe,IAAIC,gBAAgBb,OAAOC,SAASC,QAEnDY,KAAO,CACTf,QAAQa,aAAaG,IAAI,YACzBC,SAASJ,aAAaG,IAAI,YAC1BE,KAAKlC,aAAamC,MAClBC,SAASnC,kBAAkBkC,MAC3BE,QAAQnC,gBAAgBiC,MACxBG,UAA0C,KAAhCT,aAAaG,IAAI,aAAkBH,aAAaG,IAAI,aAAa,MAE/EY,QAAQC,IAAId,MACIQ,KAAKC,KAAK,CAAC,CACvBC,WAAY,8CACZV,KAAAA,QAEI,GAAGW,MAAK,SAASC,aACrB1B,OAAO2B,QAAQC,IAAIF,WACK,IAArBA,SAASG,cACRF,QAAQC,IAAIF,SAASK,cACA,mBAAE,2BACVG,kBAAWR,SAASK,iBAGrCnC,2BAA2BuC,KAAMT,SAASK,YAE3CC,MAAK,SAASC,OACbjC,OAAO2B,QAAQM,MAAMA,cAK3BzB,gBAAkB,WACpBtB,WAAWyB,OAAM,cAEb7B,aAAaiC,IAAI,GAAGqB,kBAAkB,IAExBvC,UAAUwC,OAAM,SAAAC,iBACnBA,SAASvB,IAAI,GAAGwB,wBAQvB1D,cAAcqC,OAASpC,aAAaoC,aACpCpC,aAAaiC,IAAI,GAAGqB,kBAAkB,oEACtCtD,aAAaiC,IAAI,GAAGwB,qBAMJzC,SAAS0C,MAAK,SAAAC,YACvBA,IAAIC,GAAG,sBAGdrD,aAAa0B,IAAI,GAAGqB,kBAAkB,sDACtC/C,aAAa0B,IAAI,GAAGwB,qBAIlBzB,KAAO,CACTf,QAAAA,QACA4C,KAAMpE,eAAe2C,MACrB0B,KAAMpE,aAAa0C,MACnB2B,eAAgBpE,eAAeyC,MAC/B4B,SAAUpE,eAAewC,MACzB6B,SAAUpE,eAAeuC,MACzB8B,aAAcpE,gBAAgBsC,MAC9BC,SAAUtC,cAAcqC,MACxBE,QAAStC,aAAaoC,MACtB+B,UAAWC,2BAEfvB,QAAQC,IAAId,MACIQ,KAAKC,KAAK,CAAC,CACvBC,WAAY,gCACZV,KAAAA,QAEI,GAAGW,MAAK,SAASC,aACrB1B,OAAO2B,QAAQC,IAAIF,WACK,IAArBA,SAASG,OAAe,CACvBF,QAAQC,IAAIF,SAASK,aAEfoB,OAAQ,mBAAE,sBACKA,MAAMC,KAAK,eAGnBlB,sCAA+BR,SAASK,iBACrDoB,MAAMC,KAAK,gBAAgBjB,KAAK,cAChCgB,MAAMA,MAAM,QAIhBnD,OAAOC,SAAS6B,KAAO,sDACxBE,MAAK,SAASC,OACbjC,OAAO2B,QAAQM,MAAMA,eAM3B5B,sBAAwB,WAC1B5B,eAAe4E,QAAO,cACW,KAAzB5E,eAAeyC,WAGrBJ,KAAO,CACT+B,eAAgBpE,eAAeyC,OAEnBI,KAAKC,KAAK,CAAC,CACvBC,WAAY,mDACRV,KAAAA,QAEQ,GAAGW,MAAK,SAASC,8BACnB,gBAAgB4B,6BAChB,gBAAgBA,6BAChB,iBAAiBA,UAEnBlF,QAAUmF,KAAKC,MAAM9B,SAAStD,UACjBqF,OAIbrF,QAAQsF,SAAQ,mBAAEC,QAAAA,GAAIhB,UAAAA,KAClBjE,eAAekF,oDAA6CD,gBAAOhB,sBAJnEjE,eAAewC,IAAI,IAAImC,YAM5BrB,MAAK,SAASN,UACb1B,OAAO2B,QAAQM,MAAMP,kBAM3BpB,sBAAwB,WAC1B5B,eAAe2E,QAAO,cACW,KAAzB3E,eAAewC,WAGbJ,KAAO,CACT+B,eAAgBpE,eAAeyC,MAC/B4B,SAAUpE,eAAewC,OAEbI,KAAKC,KAAK,CAAC,CACvBC,WAAY,mDACZV,KAAAA,QAEI,GAAGW,MAAK,SAASC,8BACnB,gBAAgB4B,6BAChB,iBAAiBA,UACnBjF,QAAUkF,KAAKC,MAAM9B,SAASrD,UACjBoF,OAIbpF,QAAQqF,SAAQ,oBAAEC,SAAAA,GAAIhB,WAAAA,KAClBhE,eAAeiF,oDAA6CD,gBAAOhB,sBAJnEhE,eAAeuC,IAAI,IAAImC,YAM5BrB,MAAK,SAASN,UACb1B,OAAO2B,QAAQM,MAAMP,kBAK3BnB,sBAAwB,WAC1B5B,eAAe0E,QAAO,cACW,KAAzB1E,eAAeuC,WAGbJ,KAAO,CACT+B,eAAgBpE,eAAeyC,OAInBI,KAAKC,KAAK,CAAC,CACvBC,WAAY,oDACZV,KAAAA,QAEI,GAAGW,MAAK,SAASC,8BACnB,iBAAiB4B,UACnBhF,SAAWiF,KAAKC,MAAM9B,SAASpD,WACjBmF,QAId7E,gBAAgBiF,KAAK,YAAY,GACjCvF,SAASoF,SAAQ,oBAAEC,SAAAA,GAAIG,eAAAA,SAAUC,YAAAA,MAC7BnF,gBAAgBgF,qDAA8CD,gBAAOG,sBAAaC,yBALlFnF,gBAAgBsC,IAAI,IAAImC,YAO7BrB,MAAK,SAASN,UACb1B,OAAO2B,QAAQM,MAAMP,kBAK3BwB,wBAA0B,eACxBc,WAAa,UACjBlE,SAAS4D,SAAQ,SAAAjB,KACbuB,sBAAiBvB,IAAIC,GAAG,YAAc,EAAI,UAEvCsB,WAAW7D,UAAU,EAAG6D,WAAWP,OAAS"}