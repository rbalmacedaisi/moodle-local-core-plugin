{"version":3,"file":"edit_class.min.js","sources":["../src/edit_class.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nconst classNameInput = $('#classname');\nconst typeSelector = $('#class_type');\nconst careerSelector = $('#career');\nconst periodSelector = $('#period');\nconst courseSelector = $('#courses');\nconst teacherSelector = $('#instructor');\nconst initTimeInput = $('#starttime');\nconst endTimeInput = $('#endtime');\nconst newDateInput = $('#newDate');\nconst newStartTimeInput = $('#newStartTime');\nconst newEndTimeInput = $('#newEndTime');\nconst saveButton = $('#saveClassButton');\nconst rescheduleButton = $('#rescheduleActivityButton');\nconst confirmRescheduleButton = $('#confirmRescheduleActivity');\nconst cancelRescheduleButton = $('#cancelRescheduleActivity');\nconst mondaySwitch = $('#customSwitchMonday');\nconst tuesdaySwitch = $('#customSwitchTuesday');\nconst wednesdaySwitch = $('#customSwitchWednesday');\nconst thursdaySwitch = $('#customSwitchThursday');\nconst fridaySwitch = $('#customSwitchFriday');\nconst saturdaySwitch = $('#customSwitchSaturday');\nconst sundaySwitch = $('#customSwitchSunday');\nconst rescheduleConfirmationText = $('#confirmationTextHolder');\nconst rescheduleModal = $('#rescheduleActivityModalCenter');\nconst errorModal = $('#errorModal');\nconst errorModalContent = $('#error-modal-content');\n\nconst selectors = [classNameInput, typeSelector, careerSelector, periodSelector,\n    courseSelector, teacherSelector, initTimeInput, endTimeInput];\nconst switches = [mondaySwitch, tuesdaySwitch, wednesdaySwitch, thursdaySwitch, fridaySwitch, saturdaySwitch, sundaySwitch];\nconst classId = window.location.search.substring(10,);\nlet periods;\nlet courses;\nlet teachers;\n\nexport const init = () => {\n    handleCareerSelection();\n    handlePeriodSelection();\n    handleCourseSelection();\n    handleClassSave();\n    handleActivityReschedule();\n    handleActivityRescheduleConfirmation();\n    handleActivityRescheduleCancelation();\n};\n\nconst handleActivityRescheduleCancelation = () => {\n    cancelRescheduleButton.click(()=>{\n        rescheduleConfirmationText.html(`<p>Verificando disponibilidad...</p>`);\n        confirmRescheduleButton.show();\n    });\n};\n\n\nconst handleActivityRescheduleConfirmation = () => {\n    confirmRescheduleButton.click(()=>{\n        const searchParams = new URLSearchParams(window.location.search);\n\n        const args = {\n            classId: searchParams.get('class_id'),\n            moduleId: searchParams.get('moduleId'),\n            date: newDateInput.val(),\n            initTime: newStartTimeInput.val(),\n            endTime: newEndTimeInput.val(),\n            sessionId: searchParams.get('sessionId') !== '' ? searchParams.get('sessionId') : null,\n        };\n        rescheduleConfirmationText.html(`<p>Reprogramando actividad...</p>`);\n        confirmRescheduleButton.prop('disabled', true);\n        cancelRescheduleButton.prop('disabled', true);\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_reschedule_activity',\n            args\n        }]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if (response.status === -1) {\n                rescheduleConfirmationText.html(`<p>${response.message}</p>`);\n                confirmRescheduleButton.prop('disabled', false);\n                cancelRescheduleButton.prop('disabled', false);\n                return;\n            }\n            rescheduleConfirmationText.html(`<p>Todo listo, Redirigiendo al calendario...</p>`);\n            window.location.href = '/local/grupomakro_core/pages/schedules.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n    });\n};\n\nconst handleActivityReschedule = () => {\n    rescheduleButton.click(()=>{\n        // Check if the init time is less than the end time of the class\n        if (newStartTimeInput.val() >= newEndTimeInput.val()) {\n            newEndTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            newEndTimeInput.get(0).reportValidity();\n            return false;\n        }\n        return true;\n        //\n    });\n    rescheduleModal.on('show.bs.modal', function() {\n        const searchParams = new URLSearchParams(window.location.search);\n\n        const args = {\n            classId: searchParams.get('class_id'),\n            moduleId: searchParams.get('moduleId'),\n            date: newDateInput.val(),\n            initTime: newStartTimeInput.val(),\n            endTime: newEndTimeInput.val(),\n            sessionId: searchParams.get('sessionId') !== '' ? searchParams.get('sessionId') : null\n        };\n        confirmRescheduleButton.hide();\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_check_reschedule_conflicts',\n            args\n        }]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            rescheduleConfirmationText.html(`<p>${response.message}</p>`);\n            if (response.status === -1) {\n                return;\n            }\n            confirmRescheduleButton.show();\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n        return true;\n    });\n};\n\nconst handleClassSave = () => {\n    saveButton.click(()=>{\n\n        endTimeInput.get(0).setCustomValidity('');\n        // Check the select inputs and the time inputs\n        const valid = selectors.every(selector => {\n            return selector.get(0).reportValidity();\n        });\n        if (!valid) {\n            return;\n        }\n        //\n\n        // Check if the init time is less than the end time of the class\n        if (initTimeInput.val() >= endTimeInput.val()) {\n            endTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            endTimeInput.get(0).reportValidity();\n            return;\n        }\n        //\n\n        // Check if at least one day of the week is selected\n        const daySelected = switches.some(day => {\n            return day.is(\":checked\");\n        });\n        if (!daySelected) {\n            mondaySwitch.get(0).setCustomValidity('Se debe seleccionar al menos un día de clase.');\n            mondaySwitch.get(0).reportValidity();\n            return;\n        }\n        //\n        const args = {\n            classId,\n            name: classNameInput.val(),\n            type: typeSelector.val(),\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val(),\n            courseId: courseSelector.val(),\n            instructorId: teacherSelector.val(),\n            initTime: initTimeInput.val(),\n            endTime: endTimeInput.val(),\n            classDays: formatSelectedClassDays(),\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_update_class',\n            args\n        }]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if (response.status === -1) {\n                // Add the error message to the modal content.\n                try {\n                    const errorMessages = JSON.parse(response.message);\n                    let errorHTMLString = '';\n                    errorMessages.forEach(message=>{\n                        errorHTMLString += `<p class=\"text-center\">${message}</p>`;\n                    });\n                    errorModalContent.html(errorHTMLString);\n                } catch (error) {\n                    errorModalContent.html(`<p class=\"text-center\">${response.message}</p>`);\n                } finally {\n                    errorModal.modal('show');\n                }\n            }\n            window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n\n    });\n};\n\nconst handleCareerSelection = ()=> {\n    careerSelector.change(()=> {\n        if (careerSelector.val() === '') {\n return;\n}\nconst args = {\n    learningPlanId: careerSelector.val()\n};\nconst promise = Ajax.call([{\n    methodname: 'local_sc_learningplans_get_learning_plan_periods',\n        args\n}]);\n        promise[0].done(function(response) {\n            $(\".periodValue\").remove();\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n\n            periods = JSON.parse(response.periods);\n            if (!periods.length) {\n                periodSelector.val('').change();\n                return;\n            }\n            periods.forEach(({id, name}) => {\n                periodSelector.append(`<option class=\"periodValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n\n};\n\nconst handlePeriodSelection = () => {\n    periodSelector.change(()=> {\n        if (periodSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_courses',\n            args\n        }]);\n        promise[0].done(function(response) {\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n            courses = JSON.parse(response.courses);\n            if (!courses.length) {\n                courseSelector.val('').change();\n                return;\n            }\n            courses.forEach(({id, name}) => {\n                courseSelector.append(`<option class=\"courseValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst handleCourseSelection = () => {\n    courseSelector.change(()=> {\n        if (courseSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_teachers',\n            args\n        }]);\n        promise[0].done(function(response) {\n            $(\".teacherValue\").remove();\n            teachers = JSON.parse(response.teachers);\n            if (!teachers.length) {\n                teacherSelector.val('').change();\n                return;\n            }\n            teacherSelector.prop('disabled', false);\n            teachers.forEach(({userid, fullname, email}) => {\n                teacherSelector.append(`<option class=\"teacherValue\" value=\"${userid}\">${fullname} (${email})</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst formatSelectedClassDays = ()=> {\n    let daysString = '';\n    switches.forEach(day => {\n        daysString += `${day.is(\":checked\") ? 1 : 0}/`;\n    });\n    return daysString.substring(0, daysString.length - 1);\n};"],"names":["classNameInput","typeSelector","careerSelector","periodSelector","courseSelector","teacherSelector","initTimeInput","endTimeInput","newDateInput","newStartTimeInput","newEndTimeInput","saveButton","rescheduleButton","confirmRescheduleButton","cancelRescheduleButton","mondaySwitch","tuesdaySwitch","wednesdaySwitch","thursdaySwitch","fridaySwitch","saturdaySwitch","sundaySwitch","rescheduleConfirmationText","rescheduleModal","errorModal","errorModalContent","selectors","switches","classId","window","location","search","substring","periods","courses","teachers","handleCareerSelection","handlePeriodSelection","handleCourseSelection","handleClassSave","handleActivityReschedule","handleActivityRescheduleConfirmation","handleActivityRescheduleCancelation","click","html","show","searchParams","URLSearchParams","args","get","moduleId","date","val","initTime","endTime","sessionId","prop","Ajax","call","methodname","done","response","console","log","status","message","href","fail","error","setCustomValidity","reportValidity","on","hide","every","selector","some","day","is","name","type","learningPlanId","periodId","courseId","instructorId","classDays","formatSelectedClassDays","errorMessages","JSON","parse","errorHTMLString","forEach","modal","change","remove","length","_ref","id","append","_ref2","_ref3","userid","fullname","email","daysString"],"mappings":"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"}