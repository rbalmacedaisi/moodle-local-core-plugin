{"version":3,"file":"edit_class.min.js","sources":["../src/edit_class.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nconst classNameInput = $('#classname');\nconst typeSelector = $('#class_type');\nconst careerSelector = $('#career');\nconst periodSelector = $('#period');\nconst courseSelector = $('#courses');\nconst teacherSelector = $('#instructor');\nconst initTimeInput = $('#starttime');\nconst endTimeInput = $('#endtime');\nconst newDateInput = $('#newDate');\nconst newStartTimeInput = $('#newStartTime');\nconst newEndTimeInput = $('#newEndTime');\nconst saveButton = $('#saveClassButton');\nconst rescheduleButton = $('#rescheduleActivityButton');\nconst confirmRescheduleButton = $('#confirmRescheduleActivity');\nconst cancelRescheduleButton = $('#cancelRescheduleActivity');\nconst mondaySwitch = $('#customSwitchMonday');\nconst tuesdaySwitch = $('#customSwitchTuesday');\nconst wednesdaySwitch = $('#customSwitchWednesday');\nconst thursdaySwitch = $('#customSwitchThursday');\nconst fridaySwitch = $('#customSwitchFriday');\nconst saturdaySwitch = $('#customSwitchSaturday');\nconst sundaySwitch = $('#customSwitchSunday');\nconst rescheduleConfirmationText = $('#confirmationTextHolder');\nconst rescheduleModal = $('#rescheduleActivityModalCenter');\nconst errorModal = $('#errorModal');\nconst errorModalContent = $('#error-modal-content');\n\nconst selectors = [classNameInput, typeSelector, careerSelector, periodSelector,\n    courseSelector, teacherSelector, initTimeInput, endTimeInput];\nconst switches = [mondaySwitch, tuesdaySwitch, wednesdaySwitch, thursdaySwitch, fridaySwitch, saturdaySwitch, sundaySwitch];\nconst classId = window.location.search.substring(10,);\nlet periods;\nlet courses;\nlet teachers;\n\nexport const init = () => {\n    // handleCareerSelection();\n    // handlePeriodSelection();\n    // handleCourseSelection();\n    // handleClassSave();\n    // handleActivityReschedule();\n    // handleActivityRescheduleConfirmation();\n    // handleActivityRescheduleCancelation();\n};\n\nconst handleActivityRescheduleCancelation = () => {\n    cancelRescheduleButton.click(()=>{\n        rescheduleConfirmationText.html(`<p>Verificando disponibilidad...</p>`);\n        confirmRescheduleButton.show();\n    });\n};\n\n\nconst handleActivityRescheduleConfirmation = () => {\n    confirmRescheduleButton.click(()=>{\n        const searchParams = new URLSearchParams(window.location.search);\n\n        const args = {\n            classId: searchParams.get('class_id'),\n            moduleId: searchParams.get('moduleId'),\n            date: newDateInput.val(),\n            initTime: newStartTimeInput.val(),\n            endTime: newEndTimeInput.val(),\n            sessionId: searchParams.get('sessionId') !== '' ? searchParams.get('sessionId') : null,\n        };\n        rescheduleConfirmationText.html(`<p>Reprogramando actividad...</p>`);\n        confirmRescheduleButton.prop('disabled', true);\n        cancelRescheduleButton.prop('disabled', true);\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_reschedule_activity',\n            args\n        }]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if (response.status === -1) {\n                rescheduleConfirmationText.html(`<p>${response.message}</p>`);\n                confirmRescheduleButton.prop('disabled', false);\n                cancelRescheduleButton.prop('disabled', false);\n                return;\n            }\n            rescheduleConfirmationText.html(`<p>Todo listo, Redirigiendo al calendario...</p>`);\n            window.location.href = '/local/grupomakro_core/pages/schedules.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n    });\n};\n\nconst handleActivityReschedule = () => {\n    rescheduleButton.click(()=>{\n        // Check if the init time is less than the end time of the class\n        if (newStartTimeInput.val() >= newEndTimeInput.val()) {\n            newEndTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            newEndTimeInput.get(0).reportValidity();\n            return false;\n        }\n        return true;\n        //\n    });\n    rescheduleModal.on('show.bs.modal', function() {\n        const searchParams = new URLSearchParams(window.location.search);\n\n        const args = {\n            classId: searchParams.get('class_id'),\n            moduleId: searchParams.get('moduleId'),\n            date: newDateInput.val(),\n            initTime: newStartTimeInput.val(),\n            endTime: newEndTimeInput.val(),\n            sessionId: searchParams.get('sessionId') !== '' ? searchParams.get('sessionId') : null\n        };\n        confirmRescheduleButton.hide();\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_check_reschedule_conflicts',\n            args\n        }]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            rescheduleConfirmationText.html(`<p>${response.message}</p>`);\n            if (response.status === -1) {\n                return;\n            }\n            confirmRescheduleButton.show();\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n        return true;\n    });\n};\n\nconst handleClassSave = () => {\n    saveButton.click(()=>{\n        console.log('save')\n        // endTimeInput.get(0).setCustomValidity('');\n        // // Check the select inputs and the time inputs\n        // const valid = selectors.every(selector => {\n        //     return selector.get(0).reportValidity();\n        // });\n        // if (!valid) {\n        //     return;\n        // }\n        // //\n\n        // // Check if the init time is less than the end time of the class\n        // if (initTimeInput.val() >= endTimeInput.val()) {\n        //     endTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n        //     endTimeInput.get(0).reportValidity();\n        //     return;\n        // }\n        // //\n\n        // // Check if at least one day of the week is selected\n        // const daySelected = switches.some(day => {\n        //     return day.is(\":checked\");\n        // });\n        // if (!daySelected) {\n        //     mondaySwitch.get(0).setCustomValidity('Se debe seleccionar al menos un día de clase.');\n        //     mondaySwitch.get(0).reportValidity();\n        //     return;\n        // }\n        // //\n        // const args = {\n        //     classId,\n        //     name: classNameInput.val(),\n        //     type: typeSelector.val(),\n        //     learningPlanId: careerSelector.val(),\n        //     periodId: periodSelector.val(),\n        //     courseId: courseSelector.val(),\n        //     instructorId: teacherSelector.val(),\n        //     initTime: initTimeInput.val(),\n        //     endTime: endTimeInput.val(),\n        //     classDays: formatSelectedClassDays(),\n        // };\n        // const promise = Ajax.call([{\n        //     methodname: 'local_grupomakro_update_class',\n        //     args\n        // }]);\n        // promise[0].done(function(response) {\n        //     window.console.log(response);\n        //     if (response.status === -1) {\n        //         // Add the error message to the modal content.\n        //         try {\n        //             const errorMessages = JSON.parse(response.message);\n        //             let errorHTMLString = '';\n        //             errorMessages.forEach(message=>{\n        //                 errorHTMLString += `<p class=\"text-center\">${message}</p>`;\n        //             });\n        //             errorModalContent.html(errorHTMLString);\n        //         } catch (error) {\n        //             errorModalContent.html(`<p class=\"text-center\">${response.message}</p>`);\n        //         } finally {\n        //             errorModal.modal('show');\n        //         }\n        //     }\n        //     window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n        // }).fail(function(error) {\n        //     window.console.error(error);\n        // });\n\n    });\n};\n\n// const handleCareerSelection = ()=> {\n//     careerSelector.change(()=> {\n//         if (careerSelector.val() === '') {\n//  return;\n// }\n// const args = {\n//     learningPlanId: careerSelector.val()\n// };\n// const promise = Ajax.call([{\n//     methodname: 'local_sc_learningplans_get_learning_plan_periods',\n//         args\n// }]);\n//         promise[0].done(function(response) {\n//             $(\".periodValue\").remove();\n//             $(\".courseValue\").remove();\n//             $(\".teacherValue\").remove();\n\n//             periods = JSON.parse(response.periods);\n//             if (!periods.length) {\n//                 periodSelector.val('').change();\n//                 return;\n//             }\n//             periods.forEach(({id, name}) => {\n//                 periodSelector.append(`<option class=\"periodValue\" value=\"${id}\">${name}</option>`);\n//             });\n//         }).fail(function(response) {\n//             window.console.error(response);\n//         });\n//     });\n\n// };\n\n// const handlePeriodSelection = () => {\n//     periodSelector.change(()=> {\n//         if (periodSelector.val() === '') {\n//  return;\n// }\n//         const args = {\n//             learningPlanId: careerSelector.val(),\n//             periodId: periodSelector.val()\n//         };\n//         const promise = Ajax.call([{\n//             methodname: 'local_sc_learningplans_get_learning_plan_courses',\n//             args\n//         }]);\n//         promise[0].done(function(response) {\n//             $(\".courseValue\").remove();\n//             $(\".teacherValue\").remove();\n//             courses = JSON.parse(response.courses);\n//             if (!courses.length) {\n//                 courseSelector.val('').change();\n//                 return;\n//             }\n//             courses.forEach(({id, name}) => {\n//                 courseSelector.append(`<option class=\"courseValue\" value=\"${id}\">${name}</option>`);\n//             });\n//         }).fail(function(response) {\n//             window.console.error(response);\n//         });\n//     });\n// };\n\nconst handleCourseSelection = () => {\n    courseSelector.change(()=> {\n        get_potential_teachers()\n    });\n};\n\nconst handleDateTimeInputs = () => {\n    initTimeInput.change(()=>{\n        get_potential_teachers()\n    })\n    endTimeInput.change(()=>{\n        get_potential_teachers()\n    })\n    switches.forEach(switche => {\n        switche.change(()=>{\n            get_potential_teachers()\n        })\n    })\n}\n\nconst formatSelectedClassDays = ()=> {\n    let daysString = '';\n    switches.forEach(day => {\n        daysString += `${day.is(\":checked\") ? 1 : 0}/`;\n    });\n    return daysString.substring(0, daysString.length - 1);\n};\n\nconst get_potential_teachers = () => {\n    if(!courseSelector.val() || !initTimeInput.val() || !endTimeInput.val() ){\n        return\n    }\n    // Check if at least one day of the week is selected\n    const daySelected = switches.some(day => {\n        return day.is(\":checked\");\n    });\n    if (!daySelected) {\n        return;\n    }\n    const args = {\n        courseId: courseSelector.val(),\n        initTime:initTimeInput.val(),\n        endTime:endTimeInput.val(),\n        classDays: formatSelectedClassDays(),\n    };\n    const promise = Ajax.call([{\n        methodname: 'local_grupomakro_get_potential_class_teachers',\n        args\n    }]);\n    promise[0].done(function(response) {\n        window.console.log(response)\n        $(\".teacherValue\").remove();\n        teachers = JSON.parse(response.teachers);\n        if (!teachers.length) {\n            teacherSelector.val('').change();\n            return;\n        }\n        teacherSelector.prop('disabled', false);\n        teachers.forEach(({userid, fullname, email}) => {\n            teacherSelector.append(`<option class=\"teacherValue\" value=\"${userid}\">${fullname} (${email})</option>`);\n        });\n    }).fail(function(response) {\n      window.console.error(response);\n    });\n    \n}"],"names":["window","location","search","substring"],"mappings":"6mCAGuB,qEAAE,eACJ,mBAAE,gBACA,mBAAE,YACF,mBAAE,YACF,mBAAE,aACD,mBAAE,gBACJ,mBAAE,eACH,mBAAE,aACF,mBAAE,aACG,mBAAE,kBACJ,mBAAE,gBACP,mBAAE,qBACI,mBAAE,8BACK,mBAAE,+BACH,mBAAE,8BACZ,mBAAE,wBACD,mBAAE,yBACA,mBAAE,2BACH,mBAAE,0BACJ,mBAAE,wBACA,mBAAE,0BACJ,mBAAE,wBACY,mBAAE,4BACb,mBAAE,mCACP,mBAAE,gBACK,mBAAE,wBAKZA,OAAOC,SAASC,OAAOC,UAAU,kBAK7B"}