{"version":3,"file":"edit_class.min.js","sources":["../src/edit_class.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nconst classNameInput = $('#classname');\nconst typeSelector = $('#class_type');\nconst careerSelector = $('#career');\nconst periodSelector = $('#period');\nconst courseSelector = $('#courses');\nconst teacherSelector = $('#instructor');\nconst initTimeInput = $('#starttime');\nconst endTimeInput = $('#endtime');\nconst saveButton = $('#saveClassButton');\nconst mondaySwitch = $('#customSwitchMonday');\nconst tuesdaySwitch = $('#customSwitchTuesday');\nconst wednesdaySwitch = $('#customSwitchWednesday');\nconst thursdaySwitch = $('#customSwitchThursday');\nconst fridaySwitch = $('#customSwitchFriday');\nconst saturdaySwitch = $('#customSwitchSaturday');\nconst sundaySwitch = $('#customSwitchSunday');\nconst selectors = [classNameInput,typeSelector, careerSelector, periodSelector, courseSelector, teacherSelector, initTimeInput, endTimeInput];\nconst switches = [mondaySwitch, tuesdaySwitch, wednesdaySwitch, thursdaySwitch, fridaySwitch, saturdaySwitch, sundaySwitch];\nconst classId = window.location.search.substring(10,);\n\nlet periods;\nlet courses;\nlet teachers;\n\nexport const init = () => {\n    handleCareerSelection();\n    handlePeriodSelection();\n    handleCourseSelection();\n    handleClassSave();\n};\n\n\n\nconst handleClassSave = () => {\n    saveButton.click(()=>{\n        endTimeInput.get(0).setCustomValidity('');\n        // Check the select inputs and the time inputs\n        const valid = selectors.every(selector => {\n            return selector.get(0).reportValidity();\n        });\n        if (!valid) {\n            return;\n        }\n        //\n        \n        // Check if the init time is less than the end time of the class\n        if (initTimeInput.val() >= endTimeInput.val()) {\n            endTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            endTimeInput.get(0).reportValidity();\n            return;\n        }\n        //\n        \n        // Check if at least one day of the week is selected\n        const daySelected = switches.some(day => {\n            return day.is(\":checked\");\n        });\n        if (!daySelected) {\n            mondaySwitch.get(0).setCustomValidity('Se debe seleccionar al menos un día de clase.');\n            mondaySwitch.get(0).reportValidity();\n            return;\n        }\n        //\n        const args = {\n            classId,\n            name: classNameInput.val(),\n            type: typeSelector.val(),\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val(),\n            courseId: courseSelector.val(),\n            instructorId: teacherSelector.val(),\n            initTime: initTimeInput.val(),\n            endTime: endTimeInput.val(),\n            classDays: formatSelectedClassDays(),\n        };\n        console.log(args)\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_update_class',\n            args\n        }, ]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if(response.status){\n                window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n            }\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n\n    });\n};\n\nconst handleCareerSelection = ()=> {\n    careerSelector.change(()=> {\n        if (careerSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_periods',\n            args\n        }, ]);\n        promise[0].done(function(response) {\n            $(\".periodValue\").remove();\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n\n            periods = JSON.parse(response.periods);\n            if (!periods.length) {\n                periodSelector.val('').change();\n                return;\n            }\n            periods.forEach(({id, name}) => {\n                periodSelector.append(`<option class=\"periodValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n\n};\n\nconst handlePeriodSelection = () => {\n    periodSelector.change(()=> {\n        if (periodSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_courses',\n            args\n        },]);\n        promise[0].done(function(response) {\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n            courses = JSON.parse(response.courses);\n            if (!courses.length) {\n                courseSelector.val('').change();\n                return;\n            }\n            courses.forEach(({id, name}) => {\n                courseSelector.append(`<option class=\"courseValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst handleCourseSelection = () => {\n    courseSelector.change(()=> {\n        if (courseSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            // periodId: periodSelector.val(),\n            // courseId: courseSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_teachers',\n            args\n        },]);\n        promise[0].done(function(response) {\n            $(\".teacherValue\").remove();\n            teachers = JSON.parse(response.teachers);\n            if (!teachers.length) {\n                teacherSelector.val('').change();\n                return;\n            }\n            teacherSelector.prop('disabled', false);\n            teachers.forEach(({id, fullname, email}) => {\n                teacherSelector.append(`<option class=\"teacherValue\" value=\"${id}\">${fullname} (${email})</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst formatSelectedClassDays = ()=> {\n    let daysString = '';\n    switches.forEach(day => {\n        daysString += `${day.is(\":checked\") ? 1 : 0}/`;\n    });\n    return daysString.substring(0, daysString.length - 1);\n};"],"names":["periods","courses","teachers","classNameInput","typeSelector","careerSelector","periodSelector","courseSelector","teacherSelector","initTimeInput","endTimeInput","saveButton","mondaySwitch","tuesdaySwitch","wednesdaySwitch","thursdaySwitch","fridaySwitch","saturdaySwitch","sundaySwitch","selectors","switches","classId","window","location","search","substring","handleCareerSelection","handlePeriodSelection","handleCourseSelection","handleClassSave","click","get","setCustomValidity","every","selector","reportValidity","val","some","day","is","args","name","type","learningPlanId","periodId","courseId","instructorId","initTime","endTime","classDays","formatSelectedClassDays","console","log","Ajax","call","methodname","done","response","status","href","fail","error","change","remove","JSON","parse","length","forEach","id","append","prop","fullname","email","daysString"],"mappings":"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"}