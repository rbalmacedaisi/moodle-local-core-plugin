{"version":3,"file":"edit_class.min.js","sources":["../src/edit_class.js"],"sourcesContent":["import * as Ajax from 'core/ajax';\nimport $ from 'jquery';\n\nconst classNameInput = $('#classname');\nconst typeSelector = $('#class_type');\nconst careerSelector = $('#career');\nconst periodSelector = $('#period');\nconst courseSelector = $('#courses');\nconst teacherSelector = $('#instructor');\nconst initTimeInput = $('#starttime');\nconst endTimeInput = $('#endtime');\nconst newDateInput = $('#newDate');\nconst newStartTimeInput = $('#newStartTime');\nconst newEndTimeInput = $('#newEndTime');\nconst saveButton = $('#saveClassButton');\nconst rescheduleButton = $('#rescheduleActivityButton');\nconst confirmRescheduleButton = $('#confirmRescheduleActivity');\nconst cancelRescheduleButton = $('#cancelRescheduleActivity');\nconst mondaySwitch = $('#customSwitchMonday');\nconst tuesdaySwitch = $('#customSwitchTuesday');\nconst wednesdaySwitch = $('#customSwitchWednesday');\nconst thursdaySwitch = $('#customSwitchThursday');\nconst fridaySwitch = $('#customSwitchFriday');\nconst saturdaySwitch = $('#customSwitchSaturday');\nconst sundaySwitch = $('#customSwitchSunday');\nconst rescheduleConfirmationText = $('#confirmationTextHolder');\nconst rescheduleModal = $('#rescheduleActivityModalCenter');\nconst errorModal = $('#errorModal');\nconst errorModalContent = $('#error-modal-content');\n\nconst selectors = [classNameInput, typeSelector, careerSelector, periodSelector,\n    courseSelector, teacherSelector, initTimeInput, endTimeInput];\nconst switches = [mondaySwitch, tuesdaySwitch, wednesdaySwitch, thursdaySwitch, fridaySwitch, saturdaySwitch, sundaySwitch];\nconst classId = window.location.search.substring(10,);\nlet periods;\nlet courses;\nlet teachers;\n\nexport const init = () => {\n    handleCareerSelection();\n    handlePeriodSelection();\n    handleCourseSelection();\n    handleClassSave();\n    handleActivityReschedule();\n    handleActivityRescheduleConfirmation();\n    handleActivityRescheduleCancelation();\n};\n\nconst handleActivityRescheduleCancelation = () => {\n    cancelRescheduleButton.click(()=>{\n        rescheduleConfirmationText.html(`<p>Verificando disponibilidad...</p>`);\n        confirmRescheduleButton.show();\n    });\n};\n\n\nconst handleActivityRescheduleConfirmation = () => {\n    confirmRescheduleButton.click(()=>{\n        const searchParams = new URLSearchParams(window.location.search);\n\n        const args = {\n            classId: searchParams.get('class_id'),\n            moduleId: searchParams.get('moduleId'),\n            date: newDateInput.val(),\n            initTime: newStartTimeInput.val(),\n            endTime: newEndTimeInput.val(),\n            sessionId: searchParams.get('sessionId') !== '' ? searchParams.get('sessionId') : null,\n        };\n        rescheduleConfirmationText.html(`<p>Reprogramando actividad...</p>`);\n        confirmRescheduleButton.prop('disabled', true);\n        cancelRescheduleButton.prop('disabled', true);\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_reschedule_activity',\n            args\n        }]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            if (response.status === -1) {\n                rescheduleConfirmationText.html(`<p>${response.message}</p>`);\n                confirmRescheduleButton.prop('disabled', false);\n                cancelRescheduleButton.prop('disabled', false);\n                return;\n            }\n            rescheduleConfirmationText.html(`<p>Todo listo, Redirigiendo al calendario...</p>`);\n            window.location.href = '/local/grupomakro_core/pages/schedules.php';\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n    });\n};\n\nconst handleActivityReschedule = () => {\n    rescheduleButton.click(()=>{\n        // Check if the init time is less than the end time of the class\n        if (newStartTimeInput.val() >= newEndTimeInput.val()) {\n            newEndTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n            newEndTimeInput.get(0).reportValidity();\n            return false;\n        }\n        return true;\n        //\n    });\n    rescheduleModal.on('show.bs.modal', function() {\n        const searchParams = new URLSearchParams(window.location.search);\n\n        const args = {\n            classId: searchParams.get('class_id'),\n            moduleId: searchParams.get('moduleId'),\n            date: newDateInput.val(),\n            initTime: newStartTimeInput.val(),\n            endTime: newEndTimeInput.val(),\n            sessionId: searchParams.get('sessionId') !== '' ? searchParams.get('sessionId') : null\n        };\n        confirmRescheduleButton.hide();\n        const promise = Ajax.call([{\n            methodname: 'local_grupomakro_check_reschedule_conflicts',\n            args\n        }]);\n        promise[0].done(function(response) {\n            window.console.log(response);\n            rescheduleConfirmationText.html(`<p>${response.message}</p>`);\n            if (response.status === -1) {\n                return;\n            }\n            confirmRescheduleButton.show();\n        }).fail(function(error) {\n            window.console.error(error);\n        });\n        return true;\n    });\n};\n\nconst handleClassSave = () => {\n    saveButton.click(()=>{\n        console.log('save')\n        // endTimeInput.get(0).setCustomValidity('');\n        // // Check the select inputs and the time inputs\n        // const valid = selectors.every(selector => {\n        //     return selector.get(0).reportValidity();\n        // });\n        // if (!valid) {\n        //     return;\n        // }\n        // //\n\n        // // Check if the init time is less than the end time of the class\n        // if (initTimeInput.val() >= endTimeInput.val()) {\n        //     endTimeInput.get(0).setCustomValidity('La hora de finalización debe ser mayor a la hora de inicio.');\n        //     endTimeInput.get(0).reportValidity();\n        //     return;\n        // }\n        // //\n\n        // // Check if at least one day of the week is selected\n        // const daySelected = switches.some(day => {\n        //     return day.is(\":checked\");\n        // });\n        // if (!daySelected) {\n        //     mondaySwitch.get(0).setCustomValidity('Se debe seleccionar al menos un día de clase.');\n        //     mondaySwitch.get(0).reportValidity();\n        //     return;\n        // }\n        // //\n        // const args = {\n        //     classId,\n        //     name: classNameInput.val(),\n        //     type: typeSelector.val(),\n        //     learningPlanId: careerSelector.val(),\n        //     periodId: periodSelector.val(),\n        //     courseId: courseSelector.val(),\n        //     instructorId: teacherSelector.val(),\n        //     initTime: initTimeInput.val(),\n        //     endTime: endTimeInput.val(),\n        //     classDays: formatSelectedClassDays(),\n        // };\n        // const promise = Ajax.call([{\n        //     methodname: 'local_grupomakro_update_class',\n        //     args\n        // }]);\n        // promise[0].done(function(response) {\n        //     window.console.log(response);\n        //     if (response.status === -1) {\n        //         // Add the error message to the modal content.\n        //         try {\n        //             const errorMessages = JSON.parse(response.message);\n        //             let errorHTMLString = '';\n        //             errorMessages.forEach(message=>{\n        //                 errorHTMLString += `<p class=\"text-center\">${message}</p>`;\n        //             });\n        //             errorModalContent.html(errorHTMLString);\n        //         } catch (error) {\n        //             errorModalContent.html(`<p class=\"text-center\">${response.message}</p>`);\n        //         } finally {\n        //             errorModal.modal('show');\n        //         }\n        //     }\n        //     window.location.href = '/local/grupomakro_core/pages/classmanagement.php';\n        // }).fail(function(error) {\n        //     window.console.error(error);\n        // });\n\n    });\n};\n\nconst handleCareerSelection = ()=> {\n    careerSelector.change(()=> {\n        if (careerSelector.val() === '') {\n return;\n}\nconst args = {\n    learningPlanId: careerSelector.val()\n};\nconst promise = Ajax.call([{\n    methodname: 'local_sc_learningplans_get_learning_plan_periods',\n        args\n}]);\n        promise[0].done(function(response) {\n            $(\".periodValue\").remove();\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n\n            periods = JSON.parse(response.periods);\n            if (!periods.length) {\n                periodSelector.val('').change();\n                return;\n            }\n            periods.forEach(({id, name}) => {\n                periodSelector.append(`<option class=\"periodValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n\n};\n\nconst handlePeriodSelection = () => {\n    periodSelector.change(()=> {\n        if (periodSelector.val() === '') {\n return;\n}\n        const args = {\n            learningPlanId: careerSelector.val(),\n            periodId: periodSelector.val()\n        };\n        const promise = Ajax.call([{\n            methodname: 'local_sc_learningplans_get_learning_plan_courses',\n            args\n        }]);\n        promise[0].done(function(response) {\n            $(\".courseValue\").remove();\n            $(\".teacherValue\").remove();\n            courses = JSON.parse(response.courses);\n            if (!courses.length) {\n                courseSelector.val('').change();\n                return;\n            }\n            courses.forEach(({id, name}) => {\n                courseSelector.append(`<option class=\"courseValue\" value=\"${id}\">${name}</option>`);\n            });\n        }).fail(function(response) {\n            window.console.error(response);\n        });\n    });\n};\n\nconst handleCourseSelection = () => {\n    courseSelector.change(()=> {\n        get_potential_teachers()\n    });\n};\n\nconst handleDateTimeInputs = () => {\n    initTimeInput.change(()=>{\n        get_potential_teachers()\n    })\n    endTimeInput.change(()=>{\n        get_potential_teachers()\n    })\n    switches.forEach(switche => {\n        switche.change(()=>{\n            get_potential_teachers()\n        })\n    })\n}\n\nconst formatSelectedClassDays = ()=> {\n    let daysString = '';\n    switches.forEach(day => {\n        daysString += `${day.is(\":checked\") ? 1 : 0}/`;\n    });\n    return daysString.substring(0, daysString.length - 1);\n};\n\nconst get_potential_teachers = () => {\n    if(!courseSelector.val() || !initTimeInput.val() || !endTimeInput.val() ){\n        return\n    }\n    // Check if at least one day of the week is selected\n    const daySelected = switches.some(day => {\n        return day.is(\":checked\");\n    });\n    if (!daySelected) {\n        return;\n    }\n    const args = {\n        courseId: courseSelector.val(),\n        initTime:initTimeInput.val(),\n        endTime:endTimeInput.val(),\n        classDays: formatSelectedClassDays(),\n    };\n    const promise = Ajax.call([{\n        methodname: 'local_grupomakro_get_potential_class_teachers',\n        args\n    }]);\n    promise[0].done(function(response) {\n        window.console.log(response)\n        $(\".teacherValue\").remove();\n        teachers = JSON.parse(response.teachers);\n        if (!teachers.length) {\n            teacherSelector.val('').change();\n            return;\n        }\n        teacherSelector.prop('disabled', false);\n        teachers.forEach(({userid, fullname, email}) => {\n            teacherSelector.append(`<option class=\"teacherValue\" value=\"${userid}\">${fullname} (${email})</option>`);\n        });\n    }).fail(function(response) {\n      window.console.error(response);\n    });\n    \n}"],"names":["careerSelector","periodSelector","courseSelector","teacherSelector","initTimeInput","endTimeInput","newDateInput","newStartTimeInput","newEndTimeInput","saveButton","rescheduleButton","confirmRescheduleButton","cancelRescheduleButton","mondaySwitch","tuesdaySwitch","wednesdaySwitch","thursdaySwitch","fridaySwitch","saturdaySwitch","sundaySwitch","rescheduleConfirmationText","rescheduleModal","switches","window","location","search","substring","periods","courses","teachers","handleCareerSelection","handlePeriodSelection","handleCourseSelection","handleClassSave","handleActivityReschedule","handleActivityRescheduleConfirmation","handleActivityRescheduleCancelation","click","html","show","searchParams","URLSearchParams","args","classId","get","moduleId","date","val","initTime","endTime","sessionId","prop","Ajax","call","methodname","done","response","console","log","status","message","href","fail","error","setCustomValidity","reportValidity","on","hide","change","learningPlanId","remove","JSON","parse","length","forEach","_ref","id","name","append","periodId","_ref2","get_potential_teachers","formatSelectedClassDays","daysString","day","is","some","courseId","classDays","_ref3","userid","fullname","email"],"mappings":"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"}